<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Simplicity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Some thoughts on writing simple code and other random ramblings.">
<meta property="og:type" content="website">
<meta property="og:title" content="Simplicity">
<meta property="og:url" content="http://minhajuddin.com/index.html">
<meta property="og:site_name" content="Simplicity">
<meta property="og:description" content="Some thoughts on writing simple code and other random ramblings.">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simplicity">
<meta name="twitter:description" content="Some thoughts on writing simple code and other random ramblings.">
<meta name="twitter:creator" content="@minhajuddin">
<link rel="publisher" href="+KhajaMinhajuddin">
  
    <link rel="alternative" href="/atom.xml" title="Simplicity" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-10568795-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



  

  <script>
    function enableSubmit() {
      var btn = document.getElementById('form_submit');
        btn.disabled = false;
        btn.title = '';
    }
  </script>
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Simplicity</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
          <a class="main-nav-link" href="/about/#Contact_Me">Contact</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://minhajuddin.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
          
  
    <article id="post-how-to-create-temporary-bastion-ec2-instances-using-terraform" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/06/how-to-create-temporary-bastion-ec2-instances-using-terraform/" class="article-date">
  <time datetime="2020-05-06T12:02:47.000Z" itemprop="datePublished">2020-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/06/how-to-create-temporary-bastion-ec2-instances-using-terraform/">How to create temporary bastion EC2 instances using Terraform</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have recently started learning Terraform to manage my AWS resources, And it is
a great tool for maintaining your infrastructure! I use a <a href="https://en.wikipedia.org/wiki/Bastion_host" target="_blank" rel="noopener">Bastion
host</a> to SSH into my main servers
and bring up the bastion host on demand only when I need it giving me some cost
savings. Here are the required Terraform files to get this working.</p>
<p>Set up the <code>bastion.tf</code> file like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># get a reference to aws_ami.id using a data resource by finding the right AMI</span><br><span class="line">data &quot;aws_ami&quot; &quot;ubuntu&quot; &#123;</span><br><span class="line">  # pick the most recent version of the AMI</span><br><span class="line">  most_recent = true</span><br><span class="line"></span><br><span class="line">  # Find the 20.04 image</span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;name&quot;</span><br><span class="line">    values = [&quot;ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # With the right virtualization type</span><br><span class="line">  filter &#123;</span><br><span class="line">    name   = &quot;virtualization-type&quot;</span><br><span class="line">    values = [&quot;hvm&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # And the image should be published by Canonical (which is a trusted source)</span><br><span class="line">  owners = [&quot;099720109477&quot;] # Canonical&apos;s owner_id don&apos;t change this</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Configuration for your bastion EC2 instance</span><br><span class="line">resource &quot;aws_instance&quot; &quot;bastion&quot; &#123;</span><br><span class="line">  # Use the AMI from the above step</span><br><span class="line">  ami = data.aws_ami.ubuntu.id</span><br><span class="line"></span><br><span class="line">  # We don&apos;t need a heavy duty server, t2.micro should suffice</span><br><span class="line">  instance_type = &quot;t2.micro&quot;</span><br><span class="line"></span><br><span class="line">  # We use a variable which can be set to true or false in the terraform.tfvars</span><br><span class="line">  # file to control creating or destroying the bastion resource on demand.</span><br><span class="line">  count = var.bastion_enabled ? 1 : 0</span><br><span class="line"></span><br><span class="line">  # The ssh key name</span><br><span class="line">  key_name = var.ssh_key_name</span><br><span class="line"></span><br><span class="line">  # This should refer to the subnet in which you want to spin up the Bastion host</span><br><span class="line">  # You can even hardcode this ID by getting a subnet id from the AWS console</span><br><span class="line">  subnet_id = aws_subnet.subnet[0].id</span><br><span class="line"></span><br><span class="line">  # The 2 security groups here have 2 important rules</span><br><span class="line">  # 1. hn_bastion_sg: opens up Port 22 for just my IP address</span><br><span class="line">  # 2. default: sets up an open network within the security group</span><br><span class="line">  vpc_security_group_ids = [aws_security_group.hn_bastion_sg.id, aws_default_security_group.default.id]</span><br><span class="line"></span><br><span class="line">  # Since we want to access this via internet, we need a public IP</span><br><span class="line">  associate_public_ip_address = true</span><br><span class="line"></span><br><span class="line">  # Some useful tags</span><br><span class="line">  tags = &#123;</span><br><span class="line">    Name = &quot;Bastion&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># We want to output the public_dns name of the bastion host when it spins up</span><br><span class="line">output &quot;bastion-public-dns&quot; &#123;</span><br><span class="line">  value = var.bastion_enabled ? aws_instance.bastion[0].public_dns : &quot;No-bastion&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Set up the <code>terraform.tfvars</code> file like so:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Set this to `true` and do a `terraform apply` to spin up a bastion host</span><br><span class="line"># and when you are done, set it to `false` and do another `terraform apply`</span><br><span class="line">bastion_enabled = false</span><br><span class="line"></span><br><span class="line"># My SSH keyname (without the .pem extension)</span><br><span class="line">ssh_key_name = &quot;hyperngn_aws_ohio&quot;</span><br><span class="line"></span><br><span class="line"># The IP of my computer. Do a `curl -sq icanhazip.com` to get it</span><br><span class="line">myip = [&quot;247.39.103.23/32&quot;]</span><br></pre></td></tr></table></figure></p>
<p>Set up the <code>vars.tf</code> file like so:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;ssh_key_name&quot; &#123;</span><br><span class="line">  description = &quot;Name of AWS key pair&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;myip&quot; &#123;</span><br><span class="line">  type        = list(string)</span><br><span class="line">  description = &quot;My IP to allow SSH access into the bastion server&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;bastion_enabled&quot; &#123;</span><br><span class="line">  description = &quot;Spins up a bastion host if enabled&quot;</span><br><span class="line">  type        = bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Relevant sections from my <code>vpc.tf</code>, you could just hardcode these values in the
<code>bastion.tf</code> or use <code>data</code> if you’ve set these up manually and <code>resources</code> if
you use terraform to control them</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_subnet&quot; &quot;subnet&quot; &#123;</span><br><span class="line">  # ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Allows SSH connections from our IP</span><br><span class="line">resource &quot;aws_security_group&quot; &quot;hn_bastion_sg&quot; &#123;</span><br><span class="line">  name   = &quot;hn_bastion_sg&quot;</span><br><span class="line">  vpc_id = aws_vpc.vpc.id</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    from_port   = 22</span><br><span class="line">    to_port     = 22</span><br><span class="line">    protocol    = &quot;tcp&quot;</span><br><span class="line">    cidr_blocks = var.myip</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    from_port   = 0</span><br><span class="line">    to_port     = 0</span><br><span class="line">    protocol    = &quot;-1&quot;</span><br><span class="line">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Allow inter security group connections</span><br><span class="line">resource &quot;aws_default_security_group&quot; &quot;default&quot; &#123;</span><br><span class="line">  vpc_id = aws_vpc.vpc.id</span><br><span class="line"></span><br><span class="line">  ingress &#123;</span><br><span class="line">    protocol  = -1</span><br><span class="line">    self      = true</span><br><span class="line">    from_port = 0</span><br><span class="line">    to_port   = 0</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  egress &#123;</span><br><span class="line">    from_port   = 0</span><br><span class="line">    to_port     = 0</span><br><span class="line">    protocol    = &quot;-1&quot;</span><br><span class="line">    cidr_blocks = [&quot;0.0.0.0/0&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally you need to set up your ~/.ssh/config to use the bastion as the jump
host like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Bastion config</span><br><span class="line">Host bastion</span><br><span class="line"># Change the hostname to whatever you get from terraform&apos;s output</span><br><span class="line">Hostname ec2-5-55-128-160.us-east-2.compute.amazonaws.com</span><br><span class="line">IdentityFile ~/.ssh/hyperngn_aws_ohio.pem</span><br><span class="line"></span><br><span class="line"># ECS cluster machines</span><br><span class="line">Host ecs1</span><br><span class="line">Hostname 20.10.21.217</span><br><span class="line">User ec2-user</span><br><span class="line">IdentityFile ~/.ssh/hyperngn_aws_ohio.pem</span><br><span class="line">ForwardAgent yes</span><br><span class="line">ProxyJump bastion</span><br><span class="line"></span><br><span class="line"># This section is optional but allows you to reuse SSH connections</span><br><span class="line">Host *</span><br><span class="line">  User ubuntu</span><br><span class="line">   Compression yes</span><br><span class="line"># every 10 minutes send an alive ping</span><br><span class="line">   ServerAliveInterval 60</span><br><span class="line">   ControlMaster auto</span><br><span class="line">   ControlPath /tmp/ssh-%r@%h:%p</span><br></pre></td></tr></table></figure>
<p>Once you are done, you can just login by running the following command and it
should run seamlessly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ecs1</span><br></pre></td></tr></table></figure>
<h2 id="Gotchas"><a href="#Gotchas" class="headerlink" title="Gotchas"></a>Gotchas</h2><ol>
<li>If you run into any issues use the <code>ssh -vv ecs1</code> command to get copious
logs and read through all of them to figure out what might be wrong.</li>
<li>Make sure you are using the correct <code>User</code>, Ubuntu AMIs create a user called
<code>ubuntu</code> whereas Amazon ECS optimized AMIs create an <code>ec2-user</code> user, If you
get the user wrong <code>ssh</code> will fail.</li>
<li>Use private IPs for the target servers that you are jumping into and the
public IP or public DNS for your bastion host.</li>
<li>Make sure your Bastion host is in the same VPC with a default security group
which allows inter security group communication and a security group which
opens up the SSH port for your IP. If they are not on the same VPC make sure
they have the right security groups to allow communication from the bastion
host to the target host, specifically on port 22. You can use VPC flow logs
to figure problems in your network.</li>
</ol>
<p>From a security point of view this is a pretty great set up, your normal servers
don’t allow any SSH access (and in my case aren’t even public and are fronted by
ALBs). And your bastion host is not up all the time, and even when it is up, it
only allows traffic from your single IP. It also saves cost by tearing down the
bastion instance when you don’t need it.</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2020/05/06/how-to-create-temporary-bastion-ec2-instances-using-terraform/" data-id="ck9vl2tsy003vzfwowj5ud3ya" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2020/05/06/how-to-create-temporary-bastion-ec2-instances-using-terraform/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aws/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bastion/">Bastion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ec2/">EC2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/proxyjump/">ProxyJump</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/">SSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/terraform/">Terraform</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/" class="article-date">
  <time datetime="2020-05-03T12:54:34.000Z" itemprop="datePublished">2020-05-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/">many_to_many relationships in Ecto and Phoenix for Products and Tags</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The other day I was helping a friend set up a phoenix app which required the use
of tags on products, we all have used tags in our day to day to add information
about notes, images, and other stuff. Tags are just labels/chunks-of-text which
are used to associated with an entity like a product, blog post, image, etc.
This blog post has a few tags too (Ecto, Elixir, Phoenix, etc.). Tags help us
organize information by annotating records with useful fragments of
information. And modeling these in a database is pretty straightforward, it is
usually implemented like the following design.</p>
<img src="/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/erd-small.jpg" title="Products and Tags ERD">
<p>As you can see, we have a many-to-many relation between the products and tags
tables via a products_tags table which has just 2 columns the <code>product_id</code> and
the <code>tag_id</code> and it has a composite primary key (while also having an index on
the <code>tag_id</code> to make lookups faster). The use of a join table is required,
however, you usually want the join table to be invisible in your domain, as you
don’t want to deal with a ProductTag model, it doesn’t serve any purpose other
than helping you bridge the object model with the relational model. Anyway, here
is how we ended up building the many-to-many relationship in Phoenix and Ecto.</p>
<h2 id="Scaffolding-the-models"><a href="#Scaffolding-the-models" class="headerlink" title="Scaffolding the models"></a>Scaffolding the models</h2><p>We use a nondescript <code>Core</code> context for our <code>Product</code> model by running the
following scaffold code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix phx.gen.html Core Product products name:string description:text</span><br></pre></td></tr></table></figure>
<p>This generates the following migration (I’ve omitted the boilerplate to make
reading the relevant code easier):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table(:products) do</span><br><span class="line">  add :name, :string</span><br><span class="line">  add :description, :text</span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Don’t forget to add the following to your <code>router.ex</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resources <span class="string">"/products"</span>, ProductController</span><br></pre></td></tr></table></figure>
<p>Then, we add the <code>Tag</code> in the same context by running the following scaffold
generator:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix phx.gen.html Core Tag tags name:string:unique</span><br></pre></td></tr></table></figure>
<p>This generates the following migration, note the unique index on <code>name</code>, as we
don’t want tags with duplicate names, you might have separate tags per user in
which case you would have a unique index on <code>[:user_id, :name]</code>.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table(<span class="symbol">:tags</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:name</span>, <span class="symbol">:string</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">create unique_index(<span class="symbol">:tags</span>, [<span class="symbol">:name</span>])</span><br></pre></td></tr></table></figure>
<p>Finally, we generate the migration for the join table <code>products_tags</code>(by
convention it uses the pluralized names of both entities joined by an underscore
so <code>products</code> and <code>tags</code> joined by an <code>_</code> gives us the name <code>products_tags</code>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix phx.gen.schema Core.ProductTag products_tags product_id:references:products tag_id:references:tags</span><br></pre></td></tr></table></figure>
<p>This scaffolded migration requires a few tweaks to make it look like the
following:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table(<span class="symbol">:products_tags</span>, <span class="symbol">primary_key:</span> <span class="keyword">false</span>) <span class="keyword">do</span></span><br><span class="line">  add <span class="symbol">:product_id</span>, references(<span class="symbol">:products</span>, <span class="symbol">on_delete:</span> <span class="symbol">:nothing</span>), <span class="symbol">primary_key:</span> <span class="keyword">true</span></span><br><span class="line">  add <span class="symbol">:tag_id</span>, references(<span class="symbol">:tags</span>, <span class="symbol">on_delete:</span> <span class="symbol">:nothing</span>), <span class="symbol">primary_key:</span> <span class="keyword">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">create index(<span class="symbol">:products_tags</span>, [<span class="symbol">:product_id</span>])</span><br><span class="line">create index(<span class="symbol">:products_tags</span>, [<span class="symbol">:tag_id</span>])</span><br></pre></td></tr></table></figure>
<p>Note the following:</p>
<ol>
<li>We added a <code>primary_key: false</code> declaration to the <code>table()</code> function call
to avoid creating a wasted <code>id</code> column.</li>
<li>We got rid of the <code>timestamps()</code> declaration as we don’t want to track
<code>inserts</code> and <code>updates</code> on the joins. You might want to track inserts if
you want to know when a product was tagged with a specific tag which makes
things a little more complex, so, we’ll avoid it for now.</li>
<li>We added a <code>, primary_key: true</code> to the <code>:product_id</code> and <code>:tag_id</code> lines
to make <code>[:product_id, :tag_id]</code> a composite primary key</li>
</ol>
<p>Now our database is set up nicely for our many-to-many relationship. Here is how
our tables look in the database:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">product_tags_demo_dev=# \d products</span><br><span class="line">                                       Table &quot;public.products&quot;</span><br><span class="line">┌─────────────┬────────────────────────────────┬───────────┬──────────┬─────────────────────────────┐</span><br><span class="line">│   Column    │              Type              │ Collation │ Nullable │           Default           │</span><br><span class="line">├─────────────┼────────────────────────────────┼───────────┼──────────┼─────────────────────────────┤</span><br><span class="line">│ id          │ bigint                         │           │ not null │ nextval(&apos;products_id_seq&apos;::…│</span><br><span class="line">│             │                                │           │          │…regclass)                   │</span><br><span class="line">│ name        │ character varying(255)         │           │          │                             │</span><br><span class="line">│ description │ text                           │           │          │                             │</span><br><span class="line">│ inserted_at │ timestamp(0) without time zone │           │ not null │                             │</span><br><span class="line">│ updated_at  │ timestamp(0) without time zone │           │ not null │                             │</span><br><span class="line">└─────────────┴────────────────────────────────┴───────────┴──────────┴─────────────────────────────┘</span><br><span class="line">Indexes:</span><br><span class="line">    &quot;products_pkey&quot; PRIMARY KEY, btree (id)</span><br><span class="line">Referenced by:</span><br><span class="line">    TABLE &quot;products_tags&quot; CONSTRAINT &quot;products_tags_product_id_fkey&quot; FOREIGN KEY (product_id) REFERENCES products(id)</span><br><span class="line"></span><br><span class="line">product_tags_demo_dev=# \d tags</span><br><span class="line">                                         Table &quot;public.tags&quot;</span><br><span class="line">┌─────────────┬────────────────────────────────┬───────────┬──────────┬─────────────────────────────┐</span><br><span class="line">│   Column    │              Type              │ Collation │ Nullable │           Default           │</span><br><span class="line">├─────────────┼────────────────────────────────┼───────────┼──────────┼─────────────────────────────┤</span><br><span class="line">│ id          │ bigint                         │           │ not null │ nextval(&apos;tags_id_seq&apos;::regc…│</span><br><span class="line">│             │                                │           │          │…lass)                       │</span><br><span class="line">│ name        │ character varying(255)         │           │          │                             │</span><br><span class="line">│ inserted_at │ timestamp(0) without time zone │           │ not null │                             │</span><br><span class="line">│ updated_at  │ timestamp(0) without time zone │           │ not null │                             │</span><br><span class="line">└─────────────┴────────────────────────────────┴───────────┴──────────┴─────────────────────────────┘</span><br><span class="line">Indexes:</span><br><span class="line">    &quot;tags_pkey&quot; PRIMARY KEY, btree (id)</span><br><span class="line">    &quot;tags_name_index&quot; UNIQUE, btree (name)</span><br><span class="line">Referenced by:</span><br><span class="line">    TABLE &quot;products_tags&quot; CONSTRAINT &quot;products_tags_tag_id_fkey&quot; FOREIGN KEY (tag_id) REFERENCES tags(id)</span><br><span class="line"></span><br><span class="line">product_tags_demo_dev=# \d products_tags</span><br><span class="line">              Table &quot;public.products_tags&quot;</span><br><span class="line">┌────────────┬────────┬───────────┬──────────┬─────────┐</span><br><span class="line">│   Column   │  Type  │ Collation │ Nullable │ Default │</span><br><span class="line">├────────────┼────────┼───────────┼──────────┼─────────┤</span><br><span class="line">│ product_id │ bigint │           │ not null │         │</span><br><span class="line">│ tag_id     │ bigint │           │ not null │         │</span><br><span class="line">└────────────┴────────┴───────────┴──────────┴─────────┘</span><br><span class="line">Indexes:</span><br><span class="line">    &quot;products_tags_pkey&quot; PRIMARY KEY, btree (product_id, tag_id)</span><br><span class="line">    &quot;products_tags_product_id_index&quot; btree (product_id)</span><br><span class="line">    &quot;products_tags_tag_id_index&quot; btree (tag_id)</span><br><span class="line">Foreign-key constraints:</span><br><span class="line">    &quot;products_tags_product_id_fkey&quot; FOREIGN KEY (product_id) REFERENCES products(id)</span><br><span class="line">    &quot;products_tags_tag_id_fkey&quot; FOREIGN KEY (tag_id) REFERENCES tags(id)</span><br></pre></td></tr></table></figure>
<h2 id="Getting-tags-to-work"><a href="#Getting-tags-to-work" class="headerlink" title="Getting tags to work!"></a>Getting tags to work!</h2><p>Now comes the fun part, modifying our controllers and contexts to get our tags
working!</p>
<p>The first thing we need to do is add a many_to_many relationship on the <code>Product</code> schema like so:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">schema <span class="string">"products"</span> <span class="keyword">do</span></span><br><span class="line">  field <span class="symbol">:description</span>, <span class="symbol">:string</span></span><br><span class="line">  field <span class="symbol">:name</span>, <span class="symbol">:string</span></span><br><span class="line">  many_to_many <span class="symbol">:tags</span>, ProductTagsDemo.Core.Tag, <span class="symbol">join_through:</span> <span class="string">"products_tags"</span></span><br><span class="line"></span><br><span class="line">  timestamps()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>(Note, that we don’t need to add this relationship on the other side, i.e., <code>Tag</code>
to get this working)</p>
<p>Now, we need to modify our <code>Product</code> form to show an input mechanism for tags,
the easy way to do this is to ask the users to provide a comma-separated list of
tags in an input textbox. A nicer way is to use a javascript library like
<a href="https://select2.org/getting-started/basic-usage#multi-select-boxes-pillbox" target="_blank" rel="noopener"><em>select2</em></a>.
For us, a text box with comma-separated tags will suffice.</p>
<p>The easiest way to do this is to add a text field like so:
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">label</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">text_input</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">error_tag</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>However, as soon as you wire this up you’ll get an error on the <code>/products/new</code>
page like below:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol Phoenix.HTML.Safe not implemented for #Ecto.Association.NotLoaded&lt;association :tags is not loaded&gt; of type Ecto.Association.NotLoaded (a struct).</span><br></pre></td></tr></table></figure></p>
<p>This is telling us that the <code>to_string</code> function can’t convert an
<code>Ecto.Association.NotLoaded</code> struct into a string, When you have a relation like
a <code>belongs_to</code> or <code>has_one</code> or <code>many_to_many</code> that isn’t loaded on a struct, it
has this default value. This is coming from our controller, we can remedy this
by changing our action to the following:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span></span>(conn, _params) <span class="keyword">do</span></span><br><span class="line">  changeset = Core.change_product(%Product&#123;<span class="symbol">tags:</span> []&#125;)</span><br><span class="line">  render(conn, <span class="string">"new.html"</span>, <span class="symbol">changeset:</span> changeset)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Notice the <code>tags: []</code>, we are creating a new product with an empty tags
collection so that it renders properly in the form.</p>
<p>Now that we have fixed our form, we can try submitting some tags through this
form, However, when you enter any tags and hit <code>Save</code> it doesn’t do anything
which is not surprising because we haven’t set up the handling of these tags on
the backend yet.</p>
<p>We know that the <code>tags</code> field has comma-separated tags, so we need to do the
following to be able to save a product.</p>
<ol>
<li>Split tags on a comma.</li>
<li>Strip them of whitespace.</li>
<li>Lowercase them to get them to be homogeneous (If you want your tag names to
be persisted using the input casing and still treat the uppercased version
the same as the lowercased or capitalized versions, you can use <code>:citext</code>
(short for case insensitive text) read more about how to set up <code>:citext</code>
columns in my blog post about <a href="https://minhajuddin.com/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/">storing username/email in a case insensitive
fashion</a>).</li>
<li>Once we have all the tag <code>names</code> we can insert any new tags and then fetch
the existing tags, combine them, and use <code>put_assoc</code> to put them on the
product.</li>
</ol>
<p>Step #4 creates a race condition in your code which can happen when 2 requests
try to create tags with the same name at the same time. An easy way to work
around this is to treat all the tags as new and do an upsert using
<code>Repo.insert_all</code> with an <code>on_conflict: :nothing</code> option which adds the fragment
<code>ON CONFLICT DO NOTHING</code> to your SQL making your query run successfully even if
there are tags with the same name in the database, it just doesn’t insert new
tags. Also, note that this function inserts all the tags in a single query doing
a bulk insert of all the input tags. Once you <code>upsert</code> all the tags, you can
then find them and use a <code>put_assoc</code> to create an association.</p>
<p>This is what ended up as the final <code>Core.create_product</code> function:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_product</span></span>(attrs \\ %&#123;&#125;) <span class="keyword">do</span></span><br><span class="line">  %Product&#123;&#125;</span><br><span class="line">  |&gt; Product.changeset(attrs)</span><br><span class="line">  <span class="comment"># use put_assoc to associate the input tags to the product</span></span><br><span class="line">  |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, product_tags(attrs))</span><br><span class="line">  |&gt; Repo.insert()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">parse_tags</span></span>(<span class="keyword">nil</span>), <span class="symbol">do:</span> []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">parse_tags</span></span>(tags) <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># Repo.insert_all requires the inserted_at and updated_at to be filled out</span></span><br><span class="line">  <span class="comment"># and they should have time truncated to the second that is why we need this</span></span><br><span class="line">  now = NaiveDateTime.utc_now() |&gt; NaiveDateTime.truncate(<span class="symbol">:second</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> tag &lt;- String.split(tags, <span class="string">","</span>),</span><br><span class="line">      tag = tag |&gt; String.trim() |&gt; String.downcase(),</span><br><span class="line">      tag != <span class="string">""</span>,</span><br><span class="line">      <span class="symbol">do:</span> %&#123;<span class="symbol">name:</span> tag, <span class="symbol">inserted_at:</span> now, <span class="symbol">updated_at:</span> now&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">product_tags</span></span>(attrs) <span class="keyword">do</span></span><br><span class="line">  tags = parse_tags(attrs[<span class="string">"tags"</span>]) <span class="comment"># =&gt; [%&#123;name: "phone", inserted_at: ..&#125;,  ...]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># do an upsert ensuring that all the input tags are present</span></span><br><span class="line">  Repo.insert_all(Tag, tags, <span class="symbol">on_conflict:</span> <span class="symbol">:nothing</span>)</span><br><span class="line"></span><br><span class="line">  tag_names = <span class="keyword">for</span> t &lt;- tags, <span class="symbol">do:</span> t.name</span><br><span class="line">  <span class="comment"># find all the input tags</span></span><br><span class="line">  Repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^tag_names)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>It does the following:</p>
<ol>
<li>Normalize our tags</li>
<li>Ensure that all the tags are in our database using <code>Repo.insert_all</code> with
<code>on_conflict: :nothing</code> in a single SQL query.</li>
<li>Load all the tag structs using the names.</li>
<li>Use <code>put_assoc</code> to associate the tags with the newly created product.</li>
<li>From here <code>Ecto</code> takes over and makes sure that our product has the right
association records in the <code>products_tags</code> table</li>
</ol>
<p>Notice, how through all of our code we haven’t used the <code>products_tags</code> table
except for defining the <code>many_to_many</code> relationship in the <code>Product</code> schema.</p>
<p>This is all you need to insert a product with multiple tags, However, we still
want to show the tags of a product on the product details page. We can do this
by tweaking our action and the Core module like so:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Core</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_product_with_tags!</span></span>(id), <span class="symbol">do:</span> Product |&gt; preload(<span class="symbol">:tags</span>) |&gt; Repo.get!(id)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemoWeb</span></span>.ProductController <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span>(conn, %&#123;<span class="string">"id"</span> =&gt; id&#125;) <span class="keyword">do</span></span><br><span class="line">    product = Core.get_product_with_tags!(id)</span><br><span class="line">    render(conn, <span class="string">"show.html"</span>, <span class="symbol">product:</span> product)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Here we are preloading the tags with the product and we can use it in the view
like below to show all the tags for a product:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tags: &lt;%= (for tag &lt;- @product.tags, do: tag.name) |&gt; Enum.join(", ") %&gt;</span><br></pre></td></tr></table></figure>
<p>This takes care of creating and showing a product with tags, However, if we try
to edit a product we are greeted with the following error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protocol Phoenix.HTML.Safe not implemented for #Ecto.Association.NotLoaded&lt;association :tags is not loaded&gt; of type Ecto.Association.NotLoaded (a struct).</span><br></pre></td></tr></table></figure>
<p>Hmmm, we have seen this before when we rendered a new Product without tags,
However, in this case, our product does have tags but they haven’t been
loaded/preloaded. We can remedy that easily by tweaking our <code>edit</code> action to the
following:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span></span>(conn, %&#123;<span class="string">"id"</span> =&gt; id&#125;) <span class="keyword">do</span></span><br><span class="line">  product = Core.get_product_with_tags!(id)</span><br><span class="line">  changeset = Core.change_product(product)</span><br><span class="line">  render(conn, <span class="string">"edit.html"</span>, <span class="symbol">product:</span> product, <span class="symbol">changeset:</span> changeset)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This gives us a new error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lists in Phoenix.HTML and templates may only contain integers representing bytes, binaries or other lists, got invalid entry: %ProductTagsDemo.Core.Tag&#123;__meta__: #Ecto.Schema.Metadata&lt;:loaded, &quot;tags&quot;&gt;, id: 1, inserted_at: ~N[2020-05-04 05:20:45], name: &quot;phone&quot;, updated_at: ~N[2020-05-04 05:20:45]&#125;</span><br></pre></td></tr></table></figure>
<p>This is because we are using a <code>text_input</code> for a collection of tags and when
phoenix tries to convert the list of tags into a string it fails. This is a good
place to add a custom input function:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemoWeb</span></span>.ProductView <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ProductTagsDemoWeb, <span class="symbol">:view</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tag_input</span></span>(form, field, opts \\ []) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># get the input tags collection</span></span><br><span class="line">    tags = Phoenix.HTML.Form.input_value(form, field)</span><br><span class="line">    <span class="comment"># render text using the text_input after converting tags to text</span></span><br><span class="line">    Phoenix.HTML.Form.text_input(form, field, <span class="symbol">value:</span> tags_to_text(tags), opts)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">tags_to_text</span></span>(tags) <span class="keyword">do</span></span><br><span class="line">    tags</span><br><span class="line">    |&gt; Enum.map(<span class="keyword">fn</span> t -&gt; t.name <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Enum.join(<span class="string">", "</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>With this helper we can tweak our form to:
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">label</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">tag_input</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">error_tag</span> <span class="attr">f</span>, <span class="attr">:tags</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"help-text"</span>&gt;</span>tags separated by commas<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Note that the <code>text_input</code> has been changed to <code>tag_input</code>.</p>
<p>Now, when we go to edit a product, it should render the form with the tags
separated by commas. However, updating the product by changing tags still
doesn’t work because we haven’t updated our backend code to handle this. To
complete this, we need to tweak the controller and the <code>Core</code> context like so:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemoWeb</span></span>.ProductController <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(conn, %&#123;<span class="string">"id"</span> =&gt; id, <span class="string">"product"</span> =&gt; product_params&#125;) <span class="keyword">do</span></span><br><span class="line">    product = Core.get_product_with_tags!(id)</span><br><span class="line">    <span class="comment"># ... rest is the same</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemo</span></span>.Core <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update_product</span></span>(%Product&#123;&#125; = product, attrs) <span class="keyword">do</span></span><br><span class="line">    product</span><br><span class="line">    |&gt; Product.changeset(attrs)</span><br><span class="line">    |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, product_tags(attrs))</span><br><span class="line">    |&gt; Repo.update()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Note that in the controller we are using <code>get_product_with_tags!</code> and in the
context, we inserted a line to <code>put_assoc</code> similar to the <code>create_product</code>
function which does the same things as <code>create_product</code>.</p>
<p>Astute readers will observe that our create and update product implementation
doesn’t rollback newly created tags, when <code>create_product</code> or <code>update_product</code>
fails. Let us handle this case and wrap our post!</p>
<p>Ecto provides <code>Ecto.Multi</code> to allow easy database transaction handling. This
just needs changes to our context and our view like so:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemo</span></span>.Core <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">alias</span> Ecto.Multi</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create_product</span></span>(attrs \\ %&#123;&#125;) <span class="keyword">do</span></span><br><span class="line">    multi_result =</span><br><span class="line">      Multi.new()</span><br><span class="line">      <span class="comment"># use multi to insert all the tags, so the tags are rolled back when there</span></span><br><span class="line">      <span class="comment"># is an error in product creation</span></span><br><span class="line">      |&gt; ensure_tags(attrs)</span><br><span class="line">      |&gt; Multi.insert(<span class="symbol">:product</span>, <span class="keyword">fn</span> %&#123;<span class="symbol">tags:</span> tags&#125; -&gt;</span><br><span class="line">        <span class="comment"># This chunk of code remains the same, the only difference is we let</span></span><br><span class="line">        <span class="comment"># Ecto.Multi handle insertion of the product</span></span><br><span class="line">        %Product&#123;&#125;</span><br><span class="line">        |&gt; Product.changeset(attrs)</span><br><span class="line">        |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags)</span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line">      <span class="comment"># Finally, we run all of this in a single transaction</span></span><br><span class="line">      |&gt; Repo.transaction()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># a multi result can be an :ok tagged tuple with the data from all steps</span></span><br><span class="line">    <span class="comment"># or an error tagged tuple with the failure step's atom and relevant data</span></span><br><span class="line">    <span class="comment"># in this case we only expect failures in Product insertion</span></span><br><span class="line">    <span class="keyword">case</span> multi_result <span class="keyword">do</span></span><br><span class="line">      &#123;<span class="symbol">:ok</span>, %&#123;<span class="symbol">product:</span> product&#125;&#125; -&gt; &#123;<span class="symbol">:ok</span>, product&#125;</span><br><span class="line">      &#123;<span class="symbol">:error</span>, <span class="symbol">:product</span>, changeset, <span class="number">_</span>&#125; -&gt; &#123;<span class="symbol">:error</span>, changeset&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># This is identical to `create_product`</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update_product</span></span>(%Product&#123;&#125; = product, attrs) <span class="keyword">do</span></span><br><span class="line">    multi_result =</span><br><span class="line">      Multi.new()</span><br><span class="line">      |&gt; ensure_tags(attrs)</span><br><span class="line">      |&gt; Multi.update(<span class="symbol">:product</span>, <span class="keyword">fn</span> %&#123;<span class="symbol">tags:</span> tags&#125; -&gt;</span><br><span class="line">        product</span><br><span class="line">        |&gt; Product.changeset(attrs)</span><br><span class="line">        |&gt; Ecto.Changeset.put_assoc(<span class="symbol">:tags</span>, tags)</span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line">      |&gt; Repo.transaction()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> multi_result <span class="keyword">do</span></span><br><span class="line">      &#123;<span class="symbol">:ok</span>, %&#123;<span class="symbol">product:</span> product&#125;&#125; -&gt; &#123;<span class="symbol">:ok</span>, product&#125;</span><br><span class="line">      &#123;<span class="symbol">:error</span>, <span class="symbol">:product</span>, changeset, <span class="number">_</span>&#125; -&gt; &#123;<span class="symbol">:error</span>, changeset&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># parse_tags is unchanged</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># We have created an ensure tags to use the multi struct passed along and the</span></span><br><span class="line">  <span class="comment"># repo associated with it to allow rolling back tag inserts</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">ensure_tags</span></span>(multi, attrs) <span class="keyword">do</span></span><br><span class="line">    tags = parse_tags(attrs[<span class="string">"tags"</span>])</span><br><span class="line"></span><br><span class="line">    multi</span><br><span class="line">    |&gt; Multi.insert_all(<span class="symbol">:insert_tags</span>, Tag, tags, <span class="symbol">on_conflict:</span> <span class="symbol">:nothing</span>)</span><br><span class="line">    |&gt; Multi.run(<span class="symbol">:tags</span>, <span class="keyword">fn</span> repo, _changes -&gt;</span><br><span class="line">      tag_names = <span class="keyword">for</span> t &lt;- tags, <span class="symbol">do:</span> t.name</span><br><span class="line">      &#123;<span class="symbol">:ok</span>, repo.all(from t <span class="keyword">in</span> Tag, <span class="symbol">where:</span> t.name <span class="keyword">in</span> ^tag_names)&#125;</span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProductTagsDemoWeb</span></span>.ProductView <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ProductTagsDemoWeb, <span class="symbol">:view</span></span><br><span class="line">  import Phoenix.HTML.Form</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tag_input</span></span>(form, field, opts \\ []) <span class="keyword">do</span></span><br><span class="line">    text_input(form, field, <span class="symbol">value:</span> tag_value(form.source, form, field))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># if there is an error, pass the input params along</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">tag_value</span></span>(%Ecto.Changeset&#123;<span class="symbol">valid?:</span> <span class="keyword">false</span>&#125;, form, field) <span class="keyword">do</span></span><br><span class="line">    form.params[to_string(field)]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">tag_value</span></span>(_source, form, field) <span class="keyword">do</span></span><br><span class="line">    form</span><br><span class="line">    |&gt; input_value(field)</span><br><span class="line">    |&gt; tags_to_text</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">tags_to_text</span></span>(tags) <span class="keyword">do</span></span><br><span class="line">    tags</span><br><span class="line">    |&gt; Enum.map(<span class="keyword">fn</span> t -&gt; t.name <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Enum.join(<span class="string">", "</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Whew, that was long, but hopefully, this gives you a comprehensive understanding
of how to handle <code>many_to_many</code> relationships in Ecto and Phoenix.</p>
<p>The source code associated with this blog post can be found at <a href="https://github.com/minhajuddin/product_tags_demo" target="_blank" rel="noopener">https://github.com/minhajuddin/product_tags_demo</a></p>
<p>P.S. There is a lot of duplication in our final <code>create_product</code> and
<code>update_product</code> functions, try removing the duplication in an elegant way! I’ll
share my take on it in the next post!</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/" data-id="ck9vl2tue006izfwoekccuzk8" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ecto/">Ecto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/phoenix/">Phoenix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tags/">Tags</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/many-to-many/">many_to_many</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/relationships/">relationships</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/30/how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump/" class="article-date">
  <time datetime="2019-11-30T00:36:13.000Z" itemprop="datePublished">2019-11-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/11/30/how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump/">How to dump a partial/sample table(1000 rows) in postgres using pg_dump</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The other day, I wanted to export a sample of one of my big Postgres tables from
the production server to my local computer. This was a huge table and I didn’t
want to move around a few GBs just to get a sample onto my local environment.
Unfortunately <code>pg_dump</code> doesn’t support exporting of partial tables. I looked
around and found a utility called <a href="https://github.com/mla/pg_sample" target="_blank" rel="noopener">pg_sample</a>
which is supposed to help you with this. However, I wasn’t comfortable with
installing this on my production server or letting my production data through
this script. Thinking a little more made the solution obvious. The idea was
simple:</p>
<ol>
<li><p>Create a table called <code>tmp_page_caches</code> where <code>page_caches</code> is the table that
you want to copy using <code>pg_dump</code> using the following SQL in <code>psql</code>, this
gives you a lot of freedom on SELECTing just the rows you want.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tmp_page_caches <span class="keyword">AS</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> page_caches <span class="keyword">LIMIT</span> <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Export this table using <code>pg_dump</code> as below. Here we are exporting the data to
a sql file and transforming our table name to the original table name
midstream.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pg_dump app_production --table tmp_page_caches | sed <span class="string">'s/public.tmp_/public./'</span> &gt; page_caches.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy this file to the local server using <code>scp</code> and now run it against the
local database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp minhajuddin@server.prod:page_caches.sql .</span><br><span class="line">psql app_development &lt; page_caches.sql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Get rid of the temporary table on the production server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> tmp_page_caches; <span class="comment">-- be careful not to drop the real table!</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Voila! We have successfully copied over a sample of our production table to our
local environment. Hope you find it useful.</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/11/30/how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump/" data-id="ck9vl2tt30042zfwoend7ufqb" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/11/30/how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/limit/">limit</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/partial-table/">partial table</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pg-dump/">pg_dump</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/postgresql/">postgresql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sample/">sample</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/03/how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby/" class="article-date">
  <time datetime="2019-06-03T17:51:36.000Z" itemprop="datePublished">2019-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/03/how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby/">How to copy output of a function to your clipboard in Elixir or Ruby</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Having the ability to drive your development using just a keyboard is very
productive. However, when you are using a terminal and have to copy the output
of a command to use it somewhere else, it breaks your flow, you need to move
your hands away from your keyboard, use the mouse to select the text and then
copy it.</p>
<p>When I want to copy passwords to be used elsewhere from my browser, I usually
open the developer tools console, inspect element and click on the password
input box and then run the following code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy($<span class="number">0.</span>value)</span><br></pre></td></tr></table></figure>
<p>Chrome sets <code>$0</code> to refer to the currently selected DOM element and <code>$0.value</code>
will give us the value of the password field and sending it to the <code>copy</code>
function copies this text to the OS clipboard.</p>
<p>I have a similar script set up for my terminal, when I want to copy the output
of a command like <code>rake secret</code> I run the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rake secret | xc <span class="comment"># copies a new secret to the clipboard.</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello"</span> | xc <span class="comment"># copies the string `Hello` to the clipboard.</span></span><br></pre></td></tr></table></figure>
<p><code>xc</code> is aliased to the following in my bashrc:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> xc=<span class="string">'tee /dev/tty | xclip -selection clipboard'</span></span><br></pre></td></tr></table></figure>
<p>This command prints the output to the terminal (using <code>tee /dev/tty</code>) and copies
it to the OS clipboard using the <code>xclip</code> package.</p>
<p>I wanted the same ability in my ruby and elixir REPLs. It was pretty
straightforward to do in ruby. Here is the annotated code:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="string">'loading ~/.pryrc ...'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'open3'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># copy takes an argument and converts it into a string and copies it to the OS</span></span><br><span class="line"><span class="comment"># clipboard using the `xclip` command line package.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy</span><span class="params">(text)</span></span></span><br><span class="line">  <span class="comment"># start running the `xclip` command to copy the stdin to the OS primary</span></span><br><span class="line">  <span class="comment"># clipboard. Also pass the stdin and stdout, stderr to the block</span></span><br><span class="line">  Open3.popen3(<span class="string">'xclip'</span>, <span class="string">'-selection'</span>, <span class="string">'clipboard'</span>) <span class="keyword">do</span> <span class="params">|stdin, _stdout, _stderr, _wait_thr|</span></span><br><span class="line">    <span class="comment"># convert the input argument to a string and write it to the stdin of the</span></span><br><span class="line">    <span class="comment"># spawned `xclip` process and the close the input stream</span></span><br><span class="line">    stdin.puts text.to_s</span><br><span class="line">    stdin.close</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># print out an informational message to signal that the argument has been</span></span><br><span class="line">  <span class="comment"># copied to the clipboard.</span></span><br><span class="line">  puts <span class="string">"copied to clipboard: <span class="subst">#&#123;text.to_s[<span class="number">0</span>..<span class="number">10</span>]&#125;</span>..."</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># e.g. running `copy SecureRandom.uuid` will print the following</span></span><br><span class="line"><span class="comment"># pry(main)&gt; copy SecureRandom.uuid</span></span><br><span class="line"><span class="comment"># copied to clipboard: 14438d5c-62...</span></span><br><span class="line"><span class="comment"># and copies: `14438d5c-62b9-40a1-a324-5d2bd2205990` to the OS clipboard</span></span><br></pre></td></tr></table></figure>
<p>Below is a similar script for Elixir:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">IO.puts(<span class="string">"loading ~/.iex.exs"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># open a module called `H` as we can't have functions outside modules</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">H</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># copy function takes the input and converts it into a string before copying</span></span><br><span class="line">  <span class="comment"># it to the OS clipboard.</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">copy</span></span>(text) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># convert input argument to a string</span></span><br><span class="line">    text = to_s(text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># spawn a new xclip process configured to copy the stdin to the OS's primary</span></span><br><span class="line">    <span class="comment"># clipboard</span></span><br><span class="line">    port = Port.open(&#123;<span class="symbol">:spawn</span>, <span class="string">"xclip -selection clipboard"</span>&#125;, [])</span><br><span class="line">    <span class="comment"># send the input text as stdin to the xclip process</span></span><br><span class="line">    Port.command(port, text)</span><br><span class="line">    <span class="comment"># close the port</span></span><br><span class="line">    Port.close(port)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print out an informational message to signal that the text has been copied</span></span><br><span class="line">    <span class="comment"># to the OS's clipboard"</span></span><br><span class="line">    IO.puts(<span class="string">"copied to clipboard: <span class="subst">#&#123;String.slice(text, <span class="number">0</span>, <span class="number">10</span>)&#125;</span>..."</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># to_s converts an elixir term to a string if it implements the `String.Chars`</span></span><br><span class="line">  <span class="comment"># protocol otherwise it uses `inspect` to convert it into a string.</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">to_s</span></span>(text) <span class="keyword">do</span></span><br><span class="line">    to_string(text)</span><br><span class="line">  rescue</span><br><span class="line">    <span class="number">_</span> -&gt; inspect(text)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">2</span>)&gt; <span class="symbol">:crypto</span>.strong_rand_bytes(<span class="number">16</span>) |&gt; Base.encode16 |&gt; H.copy</span><br><span class="line"><span class="comment"># copied to clipboard: 347B175C6F...</span></span><br><span class="line"><span class="comment"># it has also copied `347B175C6F397B2808DE7168444ED428` to the OS's clipboard</span></span><br></pre></td></tr></table></figure>
<p>All these utilities (except for the browser’s <code>copy</code> function) depend on the
<code>xclip</code> utility which can be installed on ubuntu using <code>sudo apt-get install
xclip</code>. You can emulate the same behaviour on a Mac using the <code>pbcopy</code> utility,
you might have to tweak things a little bit, but it should be pretty straightforward.</p>
<p>You can do the same in your favorite programming language too, just find the
right way to spawn an <code>xclip</code> process and send the text you want to be copied to
its’ stdin. Hope this makes your development a little more pleasant :)</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/06/03/how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby/" data-id="ck9vl2tsw003szfwoemgp1td3" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/06/03/how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iex/">IEx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/irb/">IRB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pry/">Pry</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">Ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/copy/">copy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pbcopy/">pbcopy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xclip/">xclip</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/" class="article-date">
  <time datetime="2019-04-14T10:59:55.000Z" itemprop="datePublished">2019-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/">How to store username or email with case insensitive search using Ecto - Part 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In a previous blog post I was trying to <a href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto/">store username/email in a case
insensitive way in
postgres</a>.
A few folks commented that the <code>citext</code> postgres extension actually did this in
a very easy and straightforward way. So, I went back to my code and ripped out
the unnecessary complexity and here is what I ended up with:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.Repo.Migrations.EnableCitextExtension <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Migration</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span> <span class="keyword">do</span></span><br><span class="line">    execute <span class="string">"CREATE EXTENSION citext"</span>, <span class="string">"DROP EXTENSION citext"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> SF.Repo.Migrations.CreateUsers <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Migration</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span> <span class="keyword">do</span></span><br><span class="line">    create table(<span class="symbol">:users</span>, <span class="symbol">primary_key:</span> <span class="keyword">false</span>) <span class="keyword">do</span></span><br><span class="line">      add <span class="symbol">:id</span>, <span class="symbol">:binary_id</span>, <span class="symbol">primary_key:</span> <span class="keyword">true</span></span><br><span class="line">      add <span class="symbol">:email</span>, <span class="symbol">:citext</span>, <span class="symbol">null:</span> <span class="keyword">false</span></span><br><span class="line">      add <span class="symbol">:magic_token</span>, <span class="symbol">:uuid</span></span><br><span class="line">      add <span class="symbol">:magic_token_created_at</span>, <span class="symbol">:naive_datetime</span></span><br><span class="line">      add <span class="symbol">:confirmation_token</span>, <span class="symbol">:uuid</span></span><br><span class="line">      add <span class="symbol">:confirmed_at</span>, <span class="symbol">:naive_datetime</span></span><br><span class="line"></span><br><span class="line">      timestamps()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:email</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:magic_token</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:confirmation_token</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.User <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line">  import Ecto.Changeset</span><br><span class="line"></span><br><span class="line">  <span class="variable">@primary_key</span> &#123;<span class="symbol">:id</span>, <span class="symbol">:binary_id</span>, <span class="symbol">autogenerate:</span> <span class="keyword">true</span>&#125;</span><br><span class="line">  <span class="variable">@foreign_key_type</span> <span class="symbol">:binary_id</span></span><br><span class="line">  schema <span class="string">"users"</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:email</span>, <span class="symbol">:string</span></span><br><span class="line">    field <span class="symbol">:magic_token</span>, Ecto.Base64UUID</span><br><span class="line">    field <span class="symbol">:confirmation_token</span>, Ecto.Base64UUID</span><br><span class="line">    field <span class="symbol">:confirmed_at</span>, <span class="symbol">:naive_datetime</span></span><br><span class="line"></span><br><span class="line">    timestamps()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@doc</span> <span class="keyword">false</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">changeset</span></span>(user, attrs) <span class="keyword">do</span></span><br><span class="line">    user</span><br><span class="line">    |&gt; cast(attrs, [<span class="symbol">:email</span>, <span class="symbol">:confirmation_token</span>])</span><br><span class="line">    |&gt; validate_required([<span class="symbol">:email</span>])</span><br><span class="line">    |&gt; unique_constraint(<span class="symbol">:email</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.UserService <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_by_email</span></span>(email) <span class="keyword">do</span></span><br><span class="line">    Repo.one(from u <span class="keyword">in</span> User, <span class="symbol">where:</span> u.email == ^email)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>So, the way <a href="https://www.postgresql.org/docs/11/citext.html" target="_blank" rel="noopener">citext</a> works is
similar to our previous approach. If you want to get into all the gory details
about how citext is implemented you can check out the code on GitHub at:
<a href="https://github.com/postgres/postgres/blob/6dd86c269d5b9a176f6c9f67ea61cc17fef9d860/contrib/citext/citext.c" target="_blank" rel="noopener">https://github.com/postgres/postgres/blob/6dd86c269d5b9a176f6c9f67ea61cc17fef9d860/contrib/citext/citext.c</a></p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/" data-id="ck9vl2ttt005bzfwopg90047t" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ecto/">Ecto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/email/">Email</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/index/">Index</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/postgresql/">Postgresql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/username/">Username</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-store-username-or-email-with-case-insensitive-search-using-ecto" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto/" class="article-date">
  <time datetime="2019-04-14T10:59:55.000Z" itemprop="datePublished">2019-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto/">How to store username or email with case insensitive search using Ecto</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I am building a small personal project which stores users in a <code>users</code> table and
every user has a unique email. So, my first model looked something like below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.Repo.Migrations.CreateUsers <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Migration</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span> <span class="keyword">do</span></span><br><span class="line">    create table(<span class="symbol">:users</span>, <span class="symbol">primary_key:</span> <span class="keyword">false</span>) <span class="keyword">do</span></span><br><span class="line">      add <span class="symbol">:id</span>, <span class="symbol">:binary_id</span>, <span class="symbol">primary_key:</span> <span class="keyword">true</span></span><br><span class="line">      add <span class="symbol">:email</span>, <span class="symbol">:string</span>, <span class="symbol">null:</span> <span class="keyword">false</span></span><br><span class="line">      add <span class="symbol">:magic_token</span>, <span class="symbol">:uuid</span></span><br><span class="line">      add <span class="symbol">:confirmation_token</span>, <span class="symbol">:uuid</span></span><br><span class="line">      add <span class="symbol">:confirmed_at</span>, <span class="symbol">:naive_datetime</span></span><br><span class="line"></span><br><span class="line">      timestamps()</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:email</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:magic_token</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">    create index(<span class="symbol">:users</span>, [<span class="symbol">:confirmation_token</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.User <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> Ecto.Schema</span><br><span class="line">  import Ecto.Changeset</span><br><span class="line"></span><br><span class="line">  <span class="variable">@primary_key</span> &#123;<span class="symbol">:id</span>, <span class="symbol">:binary_id</span>, <span class="symbol">autogenerate:</span> <span class="keyword">true</span>&#125;</span><br><span class="line">  <span class="variable">@foreign_key_type</span> <span class="symbol">:binary_id</span></span><br><span class="line">  schema <span class="string">"users"</span> <span class="keyword">do</span></span><br><span class="line">    field <span class="symbol">:email</span>, <span class="symbol">:string</span></span><br><span class="line">    field <span class="symbol">:magic_token</span>, Ecto.Base64UUID</span><br><span class="line">    field <span class="symbol">:confirmation_token</span>, Ecto.Base64UUID</span><br><span class="line">    field <span class="symbol">:confirmed_at</span>, <span class="symbol">:naive_datetime</span></span><br><span class="line"></span><br><span class="line">    timestamps()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@doc</span> <span class="keyword">false</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">changeset</span></span>(user, attrs) <span class="keyword">do</span></span><br><span class="line">    user</span><br><span class="line">    |&gt; cast(attrs, [<span class="symbol">:email</span>, <span class="symbol">:confirmation_token</span>])</span><br><span class="line">    |&gt; validate_required([<span class="symbol">:email</span>])</span><br><span class="line">    |&gt; unique_constraint(<span class="symbol">:email</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Like all good developers I had a unique index on the email field to make the
searches faster. So, when I do a <code>Repo.get_by(User, email: &quot;danny@m.com&quot;)</code>,
postgres doesn’t have to scan the whole table to find my user. However, users
sometimes enter email in mixed case, so some people might enter the above email
as <a href="mailto:`DANNY@m.com" target="_blank" rel="noopener">`DANNY@m.com</a>`, and since postgres makes a distinction between upper cased and
lower cased strings, we would end up returning a 404 Not found error to the
user. To work around this I would usually lower case the email whenever it
entered the system, in Rails you would do something like below:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateUsers</span> &lt; ActiveRecord::Migration[5.2]</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></span><br><span class="line">    create_table <span class="symbol">:users</span>, <span class="symbol">id:</span> <span class="symbol">:uuid</span> <span class="keyword">do</span> <span class="params">|t|</span></span><br><span class="line">      <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    add_index <span class="symbol">:users</span>, %i[email], <span class="symbol">unique:</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> &lt; ActiveRecord::Base</span></span><br><span class="line">  <span class="comment"># downcase email before saving</span></span><br><span class="line">  before_save <span class="symbol">:normalize_email</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">normalize_email</span></span></span><br><span class="line">    <span class="keyword">self</span>.email = email&amp;.downcase</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># always downcase before you find a record</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_by_email</span></span></span><br><span class="line">    find_by(<span class="symbol">email:</span> email.downcase)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>One downside of this approach is the need to ensure that all the emails in the
database are stored as lower case. If you mess up on your data entry code, you
might end up with a table containing the same email with different cases.</p>
<p>A better way to do this in Ecto would be to create an index on a lower cased
email like so:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index(<span class="symbol">:users</span>, [<span class="string">"(lower(email))"</span>], <span class="symbol">unique:</span> <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>
<p>This way you would never end up with a table with duplicate emails, and when you
want to find a user with an email you can do something like below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SF</span></span>.UserService <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_by_email</span></span>(email) <span class="keyword">do</span></span><br><span class="line">    email = String.downcase(email)</span><br><span class="line"></span><br><span class="line">    user =</span><br><span class="line">      Repo.one(</span><br><span class="line">        from u <span class="keyword">in</span> User,</span><br><span class="line">          <span class="symbol">where:</span> fragment(<span class="string">"lower(?)"</span>, u.email) == ^email</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    if user != <span class="keyword">nil</span>, <span class="symbol">do:</span> &#123;<span class="symbol">:ok</span>, user&#125;, <span class="symbol">else:</span> &#123;<span class="symbol">:error</span>, <span class="symbol">:not_found</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This would also make sure that your index is actually used. You can take the SQL
logged in your IEx and run a quick <code>EXPLAIN</code> to make sure that your index is
properly being used:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># EXPLAIN ANALYZE SELECT u0."id", u0."email", u0."magic_token", u0."confirmation_token", u0."confirmed_at", u0."inserted_at", u0."updated_at" FROM "users" AS u0 WHERE (lower(u0</span><br><span class="line">."email") = 'foobar@x.com');</span><br><span class="line">┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">│                                                             QUERY PLAN                                                              │</span><br><span class="line">├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ Index Scan using users__lower_email_index on users u0  (cost=0.14..8.16 rows=1 width=588) (actual time=0.013..0.014 rows=0 loops=1) │</span><br><span class="line">│   Index Cond: (lower((email)::text) = 'foobar@x.com'::text)                                                                         │</span><br><span class="line">│ Planning time: 0.209 ms                                                                                                             │</span><br><span class="line">│ Execution time: 0.064 ms                                                                                                            │</span><br><span class="line">└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br><span class="line">Time: 1.086 ms</span><br></pre></td></tr></table></figure>
<p>A common rookie mistake is creating an index on the email column and then comparing
in sql using the <code>lower</code> function like so:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">simpleform_dev=# EXPLAIN ANALYZE select * from users where lower(email) = 'danny';</span><br><span class="line">┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">│                                                     QUERY PLAN                                                      │</span><br><span class="line">├─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│ Seq Scan on users  (cost=10000000000.00..10000000001.01 rows=1 width=580) (actual time=0.034..0.034 rows=0 loops=1) │</span><br><span class="line">│   Filter: (lower((email)::text) = 'danny'::text)                                                                     │</span><br><span class="line">│   Rows Removed by Filter: 1                                                                                         │</span><br><span class="line">│ Planning time: 0.158 ms                                                                                             │</span><br><span class="line">│ Execution time: 0.076 ms                                                                                            │</span><br><span class="line">└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><br><span class="line">(5 rows)</span><br><span class="line"></span><br><span class="line">Time: 1.060 ms</span><br><span class="line">simpleform_dev=#</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto/" data-id="ck9vl2ttu005ezfwoqvlnrsb9" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ecto/">Ecto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/email/">Email</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/index/">Index</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/postgresql/">Postgresql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/username/">Username</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-view-documentation-of-callbacks-in-iex-for-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/20/how-to-view-documentation-of-callbacks-in-iex-for-elixir/" class="article-date">
  <time datetime="2019-03-20T09:36:03.000Z" itemprop="datePublished">2019-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/20/how-to-view-documentation-of-callbacks-in-iex-for-elixir/">How to view documentation of callbacks in IEx for Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The other day, I was playing around with GenServers and I needed to see the
documentation for the <code>handle_call</code> hook. I knew that this wasn’t a function
defined on the <code>GenServer</code>, So I couldn’t just do a <code>h GenServer.callback</code>. I
thought to myself that there must be a way to get callback documentation using
<code>h</code>, so I typed <code>h h</code> in IEx.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">iex(9)&gt; h h</span><br><span class="line"></span><br><span class="line">                                    def h()</span><br><span class="line"></span><br><span class="line">Prints the documentation for IEx.Helpers.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                defmacro h(term)</span><br><span class="line"></span><br><span class="line">Prints the documentation for the given module or for the given function/arity</span><br><span class="line">pair.</span><br><span class="line"></span><br><span class="line">## Examples</span><br><span class="line"></span><br><span class="line">    iex&gt; h(Enum)</span><br><span class="line"></span><br><span class="line">It also accepts functions in the format fun/arity and module.fun/arity, for</span><br><span class="line">example:</span><br><span class="line"></span><br><span class="line">    iex&gt; h(receive/1)</span><br><span class="line">    iex&gt; h(Enum.all?/2)</span><br><span class="line">    iex&gt; h(Enum.all?)</span><br><span class="line"></span><br><span class="line">iex(10)&gt;</span><br></pre></td></tr></table></figure>
<p>No luck with that! Nothing that references getting callback documentation, I
still wanted to do the naive thing and just see what <code>h GenServer.callback</code>
returned. And, to my surprise it ended up returning something useful:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iex(10)&gt; h GenServer.handle_call</span><br><span class="line">No documentation for function GenServer.handle_call was found, but there is a callback with the same name.</span><br><span class="line">You can view callback documentation with the b/1 helper.</span><br><span class="line"></span><br><span class="line">iex(11)&gt;</span><br></pre></td></tr></table></figure>
<p>Aha! These are the little things which make me love Elixir so much :’)
So, the next time you want to look up documentation about callbacks just use the
<code>b</code> helper in IEx, hope that saves you some time :) It even accepts a module and
shows you all the callbacks that a module defines!</p>
<p>P.S: The curse of knowledge is real, if I hadn’t tried the naive way, I wouldn’t
know that it was so easy to get documentation for callbacks and I would have
ended up creating a GenServer, sending a message and inspecting the arguments to
figure out what they were. So, the next time you run into a problem, it might be
worth your while to take a step back and ask yourself, How would an Elixir
beginner do this?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">iex(13)&gt; b GenServer.handle_call</span><br><span class="line">@callback handle_call(request :: term(), from(), state :: term()) ::</span><br><span class="line">            &#123;:reply, reply, new_state&#125;</span><br><span class="line">            | &#123;:reply, reply, new_state,</span><br><span class="line">               timeout() | :hibernate | &#123;:continue, term()&#125;&#125;</span><br><span class="line">            | &#123;:noreply, new_state&#125;</span><br><span class="line">            | &#123;:noreply, new_state,</span><br><span class="line">               timeout() | :hibernate | &#123;:continue, term()&#125;&#125;</span><br><span class="line">            | &#123;:stop, reason, reply, new_state&#125;</span><br><span class="line">            | &#123;:stop, reason, new_state&#125;</span><br><span class="line">          when reply: term(), new_state: term(), reason: term()</span><br><span class="line"></span><br><span class="line">Invoked to handle synchronous call/3 messages. call/3 will block until a reply</span><br><span class="line">is received (unless the call times out or nodes are disconnected).</span><br><span class="line"></span><br><span class="line">request is the request message sent by a call/3, from is a 2-tuple containing</span><br><span class="line">the caller&apos;s PID and a term that uniquely identifies the call, and state is the</span><br><span class="line">current state of the GenServer.</span><br><span class="line"></span><br><span class="line">Returning &#123;:reply, reply, new_state&#125; sends the response reply to the caller and</span><br><span class="line">continues the loop with new state new_state.</span><br><span class="line"></span><br><span class="line">Returning &#123;:reply, reply, new_state, timeout&#125; is similar to &#123;:reply, reply,</span><br><span class="line">new_state&#125; except handle_info(:timeout, new_state) will be called after timeout</span><br><span class="line">milliseconds if no messages are received.</span><br><span class="line"></span><br><span class="line">Returning &#123;:reply, reply, new_state, :hibernate&#125; is similar to &#123;:reply, reply,</span><br><span class="line">new_state&#125; except the process is hibernated and will continue the loop once a</span><br><span class="line">message is in its message queue. If a message is already in the message queue</span><br><span class="line">this will be immediately. Hibernating a GenServer causes garbage collection and</span><br><span class="line">leaves a continuous heap that minimises the memory used by the process.</span><br><span class="line"></span><br><span class="line">Returning &#123;:reply, reply, new_state, &#123;:continue, continue&#125;&#125; is similar to</span><br><span class="line">&#123;:reply, reply, new_state&#125; except c:handle_continue/2 will be invoked</span><br><span class="line">immediately after with the value continue as first argument.</span><br><span class="line"></span><br><span class="line">Hibernating should not be used aggressively as too much time could be spent</span><br><span class="line">garbage collecting. Normally it should only be used when a message is not</span><br><span class="line">expected soon and minimising the memory of the process is shown to be</span><br><span class="line">beneficial.</span><br><span class="line"></span><br><span class="line">Returning &#123;:noreply, new_state&#125; does not send a response to the caller and</span><br><span class="line">continues the loop with new state new_state. The response must be sent with</span><br><span class="line">reply/2.</span><br><span class="line"></span><br><span class="line">There are three main use cases for not replying using the return value:</span><br><span class="line"></span><br><span class="line">  • To reply before returning from the callback because the response is</span><br><span class="line">    known before calling a slow function.</span><br><span class="line">  • To reply after returning from the callback because the response is not</span><br><span class="line">    yet available.</span><br><span class="line">  • To reply from another process, such as a task.</span><br><span class="line"></span><br><span class="line">When replying from another process the GenServer should exit if the other</span><br><span class="line">process exits without replying as the caller will be blocking awaiting a reply.</span><br><span class="line"></span><br><span class="line">Returning &#123;:noreply, new_state, timeout | :hibernate | &#123;:continue, continue&#125;&#125;</span><br><span class="line">is similar to &#123;:noreply, new_state&#125; except a timeout, hibernation or continue</span><br><span class="line">occurs as with a :reply tuple.</span><br><span class="line"></span><br><span class="line">Returning &#123;:stop, reason, reply, new_state&#125; stops the loop and c:terminate/2 is</span><br><span class="line">called with reason reason and state new_state. Then the reply is sent as the</span><br><span class="line">response to call and the process exits with reason reason.</span><br><span class="line"></span><br><span class="line">Returning &#123;:stop, reason, new_state&#125; is similar to &#123;:stop, reason, reply,</span><br><span class="line">new_state&#125; except a reply is not sent.</span><br><span class="line"></span><br><span class="line">This callback is optional. If one is not implemented, the server will fail if a</span><br><span class="line">call is performed against it.</span><br><span class="line"></span><br><span class="line">iex(14)&gt;</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/03/20/how-to-view-documentation-of-callbacks-in-iex-for-elixir/" data-id="ck9vl2ttz005jzfwot0tptfq4" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/03/20/how-to-view-documentation-of-callbacks-in-iex-for-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/callbacks/">Callbacks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/documentation/">Documentation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/genserver/">GenServer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/til/">TIL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-pearls-of-elixir-interesting-patterns-from-popular-elixir-packages" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/01/pearls-of-elixir-interesting-patterns-from-popular-elixir-packages/" class="article-date">
  <time datetime="2019-02-01T09:11:16.000Z" itemprop="datePublished">2019-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/01/pearls-of-elixir-interesting-patterns-from-popular-elixir-packages/">Pearls of Elixir - Interesting patterns from popular Elixir packages</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I had a wonderful time giving a talk at the <a href="https://www.meetup.com/TorontoElixir/events/258157474/" target="_blank" rel="noopener">Elixir January Tech Meetup</a>
here in Toronto. Big thanks to <a href="https://twitter.com/ghedamat" target="_blank" rel="noopener">Mattia</a> for organizing and <a href="https://twitter.com/pagerduty" target="_blank" rel="noopener">PagerDuty</a> for
hosting the meetup!</p>
<p>I wanted to capture the talk in a blog post and here it is.</p>
<h2 id="1-Canada"><a href="#1-Canada" class="headerlink" title="1. Canada"></a>1. Canada</h2><p>Many of us have used cancan for authorization in our Rails applications. When
I was searching for a similar package in Elixir, I found the awesome <a href="https://github.com/jarednorman/canada" target="_blank" rel="noopener">canada</a>
package.</p>
<p>It’s DSL is pretty straightforward</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In this example we have a User and a Post entity.</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">User</span></span> <span class="keyword">do</span></span><br><span class="line">  defstruct <span class="symbol">id:</span> <span class="keyword">nil</span>, <span class="symbol">name:</span> <span class="keyword">nil</span>, <span class="symbol">admin:</span> <span class="keyword">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Post</span></span> <span class="keyword">do</span></span><br><span class="line">  defstruct <span class="symbol">user_id:</span> <span class="keyword">nil</span>, <span class="symbol">content:</span> <span class="keyword">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Followed by a protocol definition which allows you to define the rules on what</span></span><br><span class="line"><span class="comment"># is allowed and what is forbidden.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defimpl</span> <span class="title">Canada</span></span>.Can, <span class="symbol">for:</span> User <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">can?</span></span>(%User&#123;<span class="symbol">id:</span> user_id&#125;, action, %Post&#123;<span class="symbol">user_id:</span> user_id&#125;)</span><br><span class="line">    <span class="keyword">when</span> action <span class="keyword">in</span> [<span class="symbol">:update</span>, <span class="symbol">:read</span>, <span class="symbol">:destroy</span>, <span class="symbol">:touch</span>], <span class="symbol">do:</span> <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">can?</span></span>(%User&#123;<span class="symbol">admin:</span> admin&#125;, action, <span class="number">_</span>)</span><br><span class="line">    <span class="keyword">when</span> action <span class="keyword">in</span> [<span class="symbol">:update</span>, <span class="symbol">:read</span>, <span class="symbol">:destroy</span>, <span class="symbol">:touch</span>], <span class="symbol">do:</span> admin</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">can?</span></span>(%User&#123;&#125;, <span class="symbol">:create</span>, Post), <span class="symbol">do:</span> <span class="keyword">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Finally, when we want to use this we just use the following syntax which reads</span></span><br><span class="line"><span class="comment"># very nicely.</span></span><br><span class="line"></span><br><span class="line">import Canada, <span class="symbol">only:</span> [<span class="symbol">can?:</span> <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">if some_user |&gt; can? read(some_post) <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># render the post</span></span><br><span class="line">else</span><br><span class="line">  <span class="comment"># sorry (raise a 403)</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>When using packages, I try to take a peek at the source code and
understand how things work. And, I was <em>shocked</em> when I saw just 10 lines of
code in the <code>lib</code> folder! See for yourself:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib/canada.ex</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Canada</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">can?</span></span>(subject, &#123;action, <span class="number">_</span>, [argument]&#125;) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      Canada.Can.can? unquote(subject), unquote(action), unquote(argument)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># lib/canada/can.ex</span></span><br><span class="line"><span class="class"><span class="keyword">defprotocol</span> <span class="title">Canada</span></span>.Can <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@doc</span> <span class="string">"Evaluates permissions"</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">can?</span></span>(subject, action, resource)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The protocol is what allows you to define your custom rules for authorization
and the <code>Canada</code> module defines a neat little macro which allows you to test if
a <em>user</em> is authorized to perform an <em>action</em> using syntax like: <code>can? user,
read(post)</code>. How cool is that!</p>
<h1 id="2-Readable-binary-match-specs"><a href="#2-Readable-binary-match-specs" class="headerlink" title="2. Readable binary match specs"></a>2. Readable binary match specs</h1><p>Postgrex is another one of those packages which is filled with neat Elixir code.
When I was skimming through the code, I ran into a piece of code which surprised
me:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Postgrex</span></span>.BinaryUtils <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@moduledoc</span> <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">int64</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="symbol">do:</span> signed-<span class="number">64</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">uint16</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="symbol">do:</span> unsigned-<span class="number">16</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>I was having a difficult time understanding how <code>signed-64</code> could be valid
Elixir code. I quickly spun up an iex console and typed in <code>signed-64</code> and
unsurprisingly it threw an error. Upon further searching I found that this was
actually used in binary pattern matches all over the code:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Postgrex</span></span>.Messages <span class="keyword">do</span></span><br><span class="line">  import Postgrex.BinaryUtils</span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(&lt;&lt;type <span class="symbol">:</span>: int32, rest <span class="symbol">:</span>: binary&gt;&gt;, ?R, size) <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(&lt;&lt;pid <span class="symbol">:</span>: int32, key <span class="symbol">:</span>: int32&gt;&gt;, ?K, _size) <span class="keyword">do</span></span><br><span class="line">  <span class="comment"># ....</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>So, the macro <code>int32</code> would actually be spliced inside of a binary pattern
match. I would never have thought of doing this! And it makes the code so much
more readable and easy to follow.</p>
<h1 id="3-Compiling-lookup-tables-in-Modules"><a href="#3-Compiling-lookup-tables-in-Modules" class="headerlink" title="3. Compiling lookup tables in Modules"></a>3. Compiling lookup tables in Modules</h1><p>While browsing through postgrex, I found a text file called <code>errcodes.txt</code> which
I thought was a bit strange. Here is a snippet of that file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># errcodes.txt</span><br><span class="line">#      PostgreSQL error codes</span><br><span class="line">#</span><br><span class="line"># Copyright (c) 2003-2015, PostgreSQL Global Development Group</span><br><span class="line"></span><br><span class="line"># ...</span><br><span class="line"></span><br><span class="line">Section: Class 00 - Successful Completion</span><br><span class="line"></span><br><span class="line">00000    S    ERRCODE_SUCCESSFUL_COMPLETION                                  successful_completion</span><br><span class="line"></span><br><span class="line">Section: Class 01 - Warning</span><br><span class="line"></span><br><span class="line"># do not use this class for failure conditions</span><br><span class="line">01000    W    ERRCODE_WARNING                                                warning</span><br><span class="line">0100C    W    ERRCODE_WARNING_DYNAMIC_RESULT_SETS_RETURNED                   dynamic_result_sets_returned</span><br><span class="line">01008    W    ERRCODE_WARNING_IMPLICIT_ZERO_BIT_PADDING                      implicit_zero_bit_padding</span><br><span class="line">01003    W    ERRCODE_WARNING_NULL_VALUE_ELIMINATED_IN_SET_FUNCTION          null_value_eliminated_in_set_function</span><br><span class="line">01007    W    ERRCODE_WARNING_PRIVILEGE_NOT_GRANTED                          privilege_not_granted</span><br><span class="line">01006    W    ERRCODE_WARNING_PRIVILEGE_NOT_REVOKED                          privilege_not_revoked</span><br><span class="line">01004    W    ERRCODE_WARNING_STRING_DATA_RIGHT_TRUNCATION                   string_data_right_truncation</span><br><span class="line">01P01    W    ERRCODE_WARNING_DEPRECATED_FEATURE                             deprecated_feature</span><br><span class="line"></span><br><span class="line"># ...</span><br></pre></td></tr></table></figure>
<p>This file maps error codes to their symbols. The reason this was in the <code>lib</code>
folder was because it was supposed to be used as a source for error codes
mapping. Upon further reading I found that this was being used in a module
called <code>Postgrex.ErrorCode</code>. Here are the interesting pieces of that module:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Postgrex</span></span>.ErrorCode <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@external_resource</span> errcodes_path = Path.join(__DIR_<span class="number">_</span>, <span class="string">"errcodes.txt"</span>)</span><br><span class="line"></span><br><span class="line">  errcodes = <span class="keyword">for</span> line &lt;- File.stream!(errcodes_path),</span><br><span class="line">             <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># errcode duplication removal</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># defining a `code_to_name` function for every single error code which maps</span></span><br><span class="line">  <span class="comment"># the code to a name.</span></span><br><span class="line">  <span class="keyword">for</span> &#123;code, errcodes&#125; &lt;- Enum.group_by(errcodes, &amp;elem(&amp;<span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">do</span></span><br><span class="line">    [&#123;^code, name&#125;] = errcodes</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">code_to_name</span></span>(unquote(code)), <span class="symbol">do:</span> unquote(name)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">code_to_name</span></span>(<span class="number">_</span>), <span class="symbol">do:</span> <span class="keyword">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This code file uses our errorcodes text file to define around 400 functions which
embed the actual code to name mapping. And whenever you wanted to do the actual lookup you could just use
<code>Postgrex.ErrorCode.code_to_name(error_code)</code></p>
<img src="/2019/02/01/pearls-of-elixir-interesting-patterns-from-popular-elixir-packages/blow-my-mind.gif">
<h1 id="4-Validating-UUIDs"><a href="#4-Validating-UUIDs" class="headerlink" title="4. Validating UUIDs"></a>4. Validating UUIDs</h1><p>Did you know that you don’t need the <code>uuid</code> package to generate UUIDs? UUID
generation is available in Ecto as part of the <code>Ecto.UUID</code> module. And it even
has a function which allows you to validate a UUID. Most of us would quickly
reach for a regex pattern to validate a UUID, However, the Ecto library uses an
interesting approach:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Ecto</span></span>.UUID <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@doc</span> <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">  Casts to UUID.</span></span><br><span class="line"><span class="string">  "</span><span class="string">""</span></span><br><span class="line">  <span class="variable">@spec</span> cast(t | raw | any) <span class="symbol">:</span>: &#123;<span class="symbol">:ok</span>, t&#125; | <span class="symbol">:error</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cast</span></span>(&lt;&lt; a1, a2, a3, a4, a5, a6, a7, a8, ?-,</span><br><span class="line">              b1, b2, b3, b4, ?-,</span><br><span class="line">              c1, c2, c3, c4, ?-,</span><br><span class="line">              d1, d2, d3, d4, ?-,</span><br><span class="line">              e1, e2, e3, e4, e5, e6, e7, e8, e9, e1<span class="number">0</span>, e11, e12 &gt;&gt;) <span class="keyword">do</span></span><br><span class="line">    &lt;&lt; c(a1), c(a2), c(a3), c(a4),</span><br><span class="line">       c(a5), c(a6), c(a7), c(a8), ?-,</span><br><span class="line">       c(b1), c(b2), c(b3), c(b4), ?-,</span><br><span class="line">       c(c1), c(c2), c(c3), c(c4), ?-,</span><br><span class="line">       c(d1), c(d2), c(d3), c(d4), ?-,</span><br><span class="line">       c(e1), c(e2), c(e3), c(e4),</span><br><span class="line">       c(e5), c(e6), c(e7), c(e8),</span><br><span class="line">       c(e9), c(e1<span class="number">0</span>), c(e11), c(e12) &gt;&gt;</span><br><span class="line">  catch</span><br><span class="line">    <span class="symbol">:error</span> -&gt; <span class="symbol">:error</span></span><br><span class="line">  else</span><br><span class="line">    casted -&gt; &#123;<span class="symbol">:ok</span>, casted&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cast</span></span>(&lt;&lt; <span class="symbol">_:</span><span class="symbol">:</span><span class="number">128</span> &gt;&gt; = binary), <span class="symbol">do:</span> encode(binary)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cast</span></span>(<span class="number">_</span>), <span class="symbol">do:</span> <span class="symbol">:error</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@compile</span> &#123;<span class="symbol">:inline</span>, <span class="symbol">c:</span> <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">0</span>), <span class="symbol">do:</span> ?<span class="number">0</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">1</span>), <span class="symbol">do:</span> ?<span class="number">1</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">2</span>), <span class="symbol">do:</span> ?<span class="number">2</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">3</span>), <span class="symbol">do:</span> ?<span class="number">3</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">4</span>), <span class="symbol">do:</span> ?<span class="number">4</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">5</span>), <span class="symbol">do:</span> ?<span class="number">5</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">6</span>), <span class="symbol">do:</span> ?<span class="number">6</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">7</span>), <span class="symbol">do:</span> ?<span class="number">7</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">8</span>), <span class="symbol">do:</span> ?<span class="number">8</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?<span class="number">9</span>), <span class="symbol">do:</span> ?<span class="number">9</span></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?A), <span class="symbol">do:</span> ?a</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?B), <span class="symbol">do:</span> ?b</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?C), <span class="symbol">do:</span> ?c</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?D), <span class="symbol">do:</span> ?d</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?E), <span class="symbol">do:</span> ?e</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?F), <span class="symbol">do:</span> ?f</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?a), <span class="symbol">do:</span> ?a</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?b), <span class="symbol">do:</span> ?b</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?c), <span class="symbol">do:</span> ?c</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?d), <span class="symbol">do:</span> ?d</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?e), <span class="symbol">do:</span> ?e</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(?f), <span class="symbol">do:</span> ?f</span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">c</span></span>(<span class="number">_</span>),  <span class="symbol">do:</span> throw(<span class="symbol">:error</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This code is pretty self explanatory and is a <em>literal</em> translation of how you
would validate a UUID using a pen and paper.</p>
<h1 id="5-Honorable-Mentions"><a href="#5-Honorable-Mentions" class="headerlink" title="5. Honorable Mentions"></a>5. Honorable Mentions</h1><h3 id="Static-struct-assertions-checks-in-functions"><a href="#Static-struct-assertions-checks-in-functions" class="headerlink" title="Static struct assertions/checks in functions"></a>Static struct assertions/checks in functions</h3><p>With Elixir you can assert that the argument your function receives is of a
specific type by using a pattern like below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">User</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">authorized?</span></span>(%User&#123;&#125; = user) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># ....</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This code would blow up if the argument passed was not a <code>User</code> struct. This is
a nice way of asserting the type. However, you can overdo this by using it
everywhere. A good rule of thumb is to use this pattern in your public API at
the periphery where data comes in.</p>
<h3 id="Tagged-with-blocks"><a href="#Tagged-with-blocks" class="headerlink" title="Tagged with blocks"></a>Tagged with blocks</h3><p>You can wrap your <code>with</code> matches in tagged tuples like below if you want to
handle errors differently for different failures.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">with &#123;<span class="symbol">:parse</span>, &#123;<span class="symbol">:ok</span>, user_attrs&#125;&#125; &lt;- &#123;<span class="symbol">:parse</span>, Jason.parse(body)&#125;,</span><br><span class="line">     &#123;<span class="symbol">:persist</span>, &#123;<span class="symbol">:ok</span>, user&#125;&#125; &lt;- &#123;<span class="symbol">:persist</span>, Users.create(user_attrs)&#125;,</span><br><span class="line">     &#123;<span class="symbol">:welcome_email</span>, <span class="symbol">:ok</span>&#125; &lt;- &#123;<span class="symbol">:welcome_email</span>, Emailer.welcome(user)&#125; <span class="keyword">do</span></span><br><span class="line">     <span class="symbol">:ok</span></span><br><span class="line">else</span><br><span class="line">  &#123;<span class="symbol">:parse</span>, err&#125; -&gt;</span><br><span class="line">    <span class="comment"># raise an error</span></span><br><span class="line">    &#123;<span class="symbol">:error</span>, <span class="symbol">:parse_error</span>&#125;</span><br><span class="line">  &#123;<span class="symbol">:persist</span>, &#123;<span class="symbol">:error</span>, changeset&#125;&#125; -&gt;</span><br><span class="line">    <span class="comment"># return validation errors</span></span><br><span class="line">    &#123;<span class="symbol">:error</span>, changeset&#125;</span><br><span class="line">  &#123;<span class="symbol">:welcome_email</span>, err&#125; -&gt;</span><br><span class="line">    <span class="comment"># it is ok if email sending failed, we just log this</span></span><br><span class="line">    Logger.error(<span class="string">"SENDING_WELCOME_EMAIL_FAILED"</span>)</span><br><span class="line">    <span class="symbol">:ok</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Delegating-function-calls-on-your-root-API-module"><a href="#Delegating-function-calls-on-your-root-API-module" class="headerlink" title="Delegating function calls on your root API module"></a>Delegating function calls on your root API module</h3><p><code>defdelegate</code> allows you to delegate function calls to a different module using
the same arguments.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">API</span></span> <span class="keyword">do</span></span><br><span class="line">  defdelegate create_customer(customer_json), <span class="symbol">to:</span> API.CustomerCreator</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">API</span></span>.CustomerCreator <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create_customer</span></span>(customer_json) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Enforcing-Keys"><a href="#Enforcing-Keys" class="headerlink" title="Enforcing Keys"></a>Enforcing Keys</h3><p>While defining a struct you can also define which keys are mandatory.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">User</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@enforce_keys</span> [<span class="symbol">:email</span>, <span class="symbol">:name</span>]</span><br><span class="line">  defstruct [<span class="symbol">:email</span>, <span class="symbol">:name</span>]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Interpolation-in-docs"><a href="#Interpolation-in-docs" class="headerlink" title="Interpolation in docs"></a>Interpolation in docs</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">HTTPClient</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@timeout</span> <span class="number">60_000</span></span><br><span class="line">  <span class="variable">@doc</span> <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">  Times out after <span class="subst">#&#123;<span class="variable">@timeout</span>&#125;</span> seconds</span></span><br><span class="line"><span class="string">  "</span><span class="string">""</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Suppressing-logs-in-your-tests"><a href="#Suppressing-logs-in-your-tests" class="headerlink" title="Suppressing logs in your tests"></a>Suppressing logs in your tests</h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ExUnit.start</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">HTTPTest</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line">  require Logger</span><br><span class="line"></span><br><span class="line">  <span class="variable">@moduletag</span> <span class="symbol">:capture_log</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"suppress logs"</span> <span class="keyword">do</span></span><br><span class="line">    Logger.info <span class="string">"AAAAAAAAAAAAAAAAAAAHHHHHHHHH"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><ul>
<li><a href="https://github.com/jarednorman/canada" target="_blank" rel="noopener">Canada</a></li>
<li><a href="https://github.com/elixir-ecto/postgrex/blob/master/lib/postgrex/binary_utils.ex" target="_blank" rel="noopener">Postgrex.BinaryUtils</a></li>
<li><a href="https://github.com/elixir-ecto/postgrex/blob/master/lib/postgrex/error_code.ex" target="_blank" rel="noopener">Postgrex.ErrorCode</a></li>
<li><a href="https://github.com/elixir-ecto/ecto/blob/master/lib/ecto/uuid.ex" target="_blank" rel="noopener">Ecto.UUID</a></li>
</ul>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2019/02/01/pearls-of-elixir-interesting-patterns-from-popular-elixir-packages/" data-id="ck9vl2tun0072zfwokhn03zr0" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2019/02/01/pearls-of-elixir-interesting-patterns-from-popular-elixir-packages/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pearls/">Pearls</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-solution-to-advent-of-code-2018-day-5-in-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/14/solution-to-advent-of-code-2018-day-5-in-elixir/" class="article-date">
  <time datetime="2018-12-14T05:26:18.000Z" itemprop="datePublished">2018-12-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/14/solution-to-advent-of-code-2018-day-5-in-elixir/">Solution to Advent of Code 2018 Day 5 in Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day5</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">scan</span></span>(polymer) <span class="keyword">do</span></span><br><span class="line">    chars =</span><br><span class="line">      polymer</span><br><span class="line">      |&gt; String.to_charlist()</span><br><span class="line"></span><br><span class="line">    res =</span><br><span class="line">      chars</span><br><span class="line">      |&gt; Enum.reduce(&#123;<span class="symbol">:none</span>, []&#125;, <span class="keyword">fn</span></span><br><span class="line">        c, &#123;<span class="symbol">:none</span>, acc&#125; -&gt;</span><br><span class="line">          &#123;<span class="symbol">:prev</span>, c, acc&#125;</span><br><span class="line"></span><br><span class="line">        c, &#123;<span class="symbol">:prev</span>, prev, acc&#125; -&gt;</span><br><span class="line">          if react?(c, prev) <span class="keyword">do</span></span><br><span class="line">            &#123;<span class="symbol">:none</span>, acc&#125;</span><br><span class="line">          else</span><br><span class="line">            &#123;<span class="symbol">:prev</span>, c, [prev | acc]&#125;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    reduced_polymer =</span><br><span class="line">      <span class="keyword">case</span> res <span class="keyword">do</span></span><br><span class="line">        &#123;<span class="number">_</span>, acc&#125; -&gt; acc</span><br><span class="line">        &#123;<span class="symbol">:prev</span>, c, acc&#125; -&gt; [c | acc]</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      |&gt; Enum.reverse()</span><br><span class="line">      |&gt; to_string</span><br><span class="line"></span><br><span class="line">    if reduced_polymer == polymer <span class="keyword">do</span></span><br><span class="line">      polymer</span><br><span class="line">    else</span><br><span class="line">      scan(reduced_polymer)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">react?</span></span>(c1, c2), <span class="symbol">do:</span> abs(c1 - c2) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@all_units</span> Enum.zip(?a..?z, ?A..?Z) |&gt; Enum.map(<span class="keyword">fn</span> &#123;c1, c2&#125; -&gt; ~r[<span class="comment">#&#123;[c1]&#125;|#&#123;[c2]&#125;] end)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">smallest</span></span>(polymer) <span class="keyword">do</span></span><br><span class="line">    <span class="variable">@all_units</span></span><br><span class="line">    |&gt; Enum.map(<span class="keyword">fn</span> unit_to_be_removed -&gt;</span><br><span class="line">      polymer</span><br><span class="line">      |&gt; String.replace(unit_to_be_removed, <span class="string">""</span>)</span><br><span class="line">      |&gt; scan</span><br><span class="line">      |&gt; String.length()</span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Enum.min()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day5Test</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line"></span><br><span class="line">  import Day5</span><br><span class="line"></span><br><span class="line">  test <span class="string">"reduces 2 reacting units"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"aA"</span>) == <span class="string">""</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"reduces 2 non reacting units"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"aB"</span>) == <span class="string">"aB"</span></span><br><span class="line">    assert scan(<span class="string">"Ba"</span>) == <span class="string">"Ba"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"reduces 3 non reacting units"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"aBc"</span>) == <span class="string">"aBc"</span></span><br><span class="line">    assert scan(<span class="string">"aBA"</span>) == <span class="string">"aBA"</span></span><br><span class="line">    assert scan(<span class="string">"BaD"</span>) == <span class="string">"BaD"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"reduces 3 reacting units"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"aAB"</span>) == <span class="string">"B"</span></span><br><span class="line">    assert scan(<span class="string">"abB"</span>) == <span class="string">"a"</span></span><br><span class="line">    assert scan(<span class="string">"aBb"</span>) == <span class="string">"a"</span></span><br><span class="line">    assert scan(<span class="string">"BaA"</span>) == <span class="string">"B"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"reduces recursively"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"baAB"</span>) == <span class="string">""</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"large polymer"</span> <span class="keyword">do</span></span><br><span class="line">    assert scan(<span class="string">"dabAcCaCBAcCcaDA"</span>) == <span class="string">"dabCBAcaDA"</span></span><br><span class="line">    assert scan(<span class="string">"abcdDCBA"</span>) == <span class="string">""</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"input"</span> <span class="keyword">do</span></span><br><span class="line">    assert File.read!(<span class="string">"./input.txt"</span>) |&gt; String.trim() |&gt; scan |&gt; String.length() == <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"smallest"</span> <span class="keyword">do</span></span><br><span class="line">    assert smallest(<span class="string">"dabAcCaCBAcCcaDA"</span>) == <span class="number">4</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"smallest for input"</span> <span class="keyword">do</span></span><br><span class="line">    assert File.read!(<span class="string">"./input.txt"</span>) |&gt; String.trim() |&gt; smallest == <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/14/solution-to-advent-of-code-2018-day-5-in-elixir/" data-id="ck9vl2tvj008kzfwou249d1pk" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/14/solution-to-advent-of-code-2018-day-5-in-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/advent-of-code/">Advent of Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-solution-to-advent-of-code-2018-day-4-in-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/14/solution-to-advent-of-code-2018-day-4-in-elixir/" class="article-date">
  <time datetime="2018-12-14T05:24:48.000Z" itemprop="datePublished">2018-12-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/14/solution-to-advent-of-code-2018-day-4-in-elixir/">Solution to Advent of Code 2018 Day 4 in Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day4</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="class"><span class="keyword">defmodule</span> <span class="title">State</span></span> <span class="keyword">do</span></span><br><span class="line">    defstruct [<span class="symbol">:guard_id</span>, <span class="symbol">:start</span>, <span class="symbol">:sleep</span>]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">desc_minutes</span></span>(&#123;_k, ranges&#125;) <span class="keyword">do</span></span><br><span class="line">    ranges</span><br><span class="line">    |&gt; Enum.reduce(<span class="number">0</span>, <span class="keyword">fn</span> x, sum -&gt;</span><br><span class="line">      sum + Enum.count(x)</span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Kernel.*(-<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_sleep_constant</span></span>(spec) <span class="keyword">do</span></span><br><span class="line">    &#123;guard, sleep_durations&#125; =</span><br><span class="line">      spec</span><br><span class="line">      |&gt; parse</span><br><span class="line">      |&gt; Enum.sort_by(&amp;desc_minutes/<span class="number">1</span>)</span><br><span class="line">      |&gt; hd</span><br><span class="line"></span><br><span class="line">    guard * most_sleepy_minute(sleep_durations)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sleepiest_guard_minute</span></span>(spec) <span class="keyword">do</span></span><br><span class="line">    &#123;guard_id, &#123;min, _count&#125;&#125; =</span><br><span class="line">      spec</span><br><span class="line">      |&gt; parse <span class="comment"># =&gt; %&#123; guard_id =&gt; [min_start1..min_end1] &#125;</span></span><br><span class="line">      |&gt; Enum.map(<span class="keyword">fn</span> &#123;guard_id, durations&#125; -&gt;</span><br><span class="line">        &#123;min, occurences&#125; =</span><br><span class="line">          durations</span><br><span class="line">          |&gt; Enum.flat_map(&amp;Enum.to_list/<span class="number">1</span>)</span><br><span class="line">          |&gt; Enum.group_by(&amp; &amp;<span class="number">1</span>)</span><br><span class="line">          |&gt; Enum.max_by(<span class="keyword">fn</span> &#123;_min, occurences&#125; -&gt; Enum.count(occurences) <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">        &#123;guard_id, &#123;min, length(occurences)&#125;&#125;</span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line">      |&gt; Enum.max_by(<span class="keyword">fn</span> &#123;_guard_id, &#123;_min, count&#125;&#125; -&gt; count <span class="keyword">end</span>)</span><br><span class="line">    &#123;guard_id, min&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">most_sleepy_minute</span></span>(sleep_durations) <span class="keyword">do</span></span><br><span class="line">    &#123;minute, <span class="number">_</span>&#125; =</span><br><span class="line">      sleep_durations</span><br><span class="line">      |&gt; Enum.flat_map(&amp;Enum.to_list/<span class="number">1</span>)</span><br><span class="line">      |&gt; Enum.group_by(&amp; &amp;<span class="number">1</span>)</span><br><span class="line">      |&gt; Enum.sort_by(<span class="keyword">fn</span> &#123;_k, v&#125; -&gt; -<span class="number">1</span> * Enum.count(v) <span class="keyword">end</span>)</span><br><span class="line">      |&gt; hd</span><br><span class="line"></span><br><span class="line">    minute</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(spec) <span class="keyword">do</span></span><br><span class="line">    &#123;_state, logs&#125; =</span><br><span class="line">      spec</span><br><span class="line">      |&gt; String.split(<span class="string">"\n"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">      |&gt; Enum.sort()</span><br><span class="line">      |&gt; Enum.map(&amp;parse_line/<span class="number">1</span>)</span><br><span class="line">      |&gt; Enum.reduce(&#123;_state = %State&#123;&#125;, _out = %&#123;&#125;&#125;, <span class="keyword">fn</span> x, &#123;state, out&#125; -&gt;</span><br><span class="line">        <span class="keyword">case</span> x <span class="keyword">do</span></span><br><span class="line">          &#123;<span class="symbol">:start</span>, guard_id, _minutes&#125; -&gt;</span><br><span class="line">            &#123;%&#123;state | <span class="symbol">guard_id:</span> guard_id&#125;, out&#125;</span><br><span class="line"></span><br><span class="line">          &#123;<span class="symbol">:sleep</span>, minutes&#125; -&gt;</span><br><span class="line">            &#123;%&#123;state | <span class="symbol">start:</span> minutes&#125;, out&#125;</span><br><span class="line"></span><br><span class="line">          &#123;<span class="symbol">:wake</span>, minutes&#125; -&gt;</span><br><span class="line">            prev_sleep = out[state.guard_id] || []</span><br><span class="line">            &#123;state, Map.put(out, state.guard_id, [state.start..(minutes - <span class="number">1</span>) | prev_sleep])&#125;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    logs</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_line</span></span>(line) <span class="keyword">do</span></span><br><span class="line">    &lt;&lt;<span class="string">"["</span>, <span class="symbol">_year:</span><span class="symbol">:</span><span class="number">32</span>, <span class="string">"-"</span>, <span class="symbol">_month:</span><span class="symbol">:</span><span class="number">16</span>, <span class="string">"-"</span>, <span class="symbol">_day:</span><span class="symbol">:</span><span class="number">16</span>, <span class="string">" "</span>, <span class="symbol">_hour:</span><span class="symbol">:</span><span class="number">16</span>, <span class="string">":"</span>,</span><br><span class="line">      <span class="symbol">minutes_bin:</span><span class="symbol">:binary-size</span>(<span class="number">2</span>), <span class="string">"] "</span>, <span class="symbol">note:</span><span class="symbol">:binary&gt;&gt;</span> = line</span><br><span class="line"></span><br><span class="line">    parse_note(note, String.to_integer(minutes_bin))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_note</span></span>(<span class="string">"wakes up"</span>, minutes) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:wake</span>, minutes&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_note</span></span>(<span class="string">"falls asleep"</span>, minutes) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:sleep</span>, minutes&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_note</span></span>(begin_note, minutes) <span class="keyword">do</span></span><br><span class="line">    guard_id =</span><br><span class="line">      Regex.named_captures(~r[Guard <span class="comment">#(?&lt;guard_id&gt;\d+) begins shift], begin_note)</span></span><br><span class="line">      |&gt; Map.get(<span class="string">"guard_id"</span>)</span><br><span class="line">      |&gt; String.to_integer()</span><br><span class="line"></span><br><span class="line">    &#123;<span class="symbol">:start</span>, guard_id, minutes&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day4Test</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line"></span><br><span class="line">  import Day4</span><br><span class="line"></span><br><span class="line">  test <span class="string">"parses the times when each guard sleeps"</span> <span class="keyword">do</span></span><br><span class="line">    assert parse(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           [1518-11-01 00:00] Guard #10 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-01 00:05] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-01 00:25] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-01 00:30] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-01 00:55] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-01 23:58] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-02 00:40] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-02 00:50] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-03 00:05] Guard #10 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-03 00:24] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-03 00:29] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-04 00:02] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-04 00:36] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-04 00:46] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-05 00:03] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-05 00:45] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-05 00:55] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-08 00:03] Guard #99334 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-08 00:45] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-08 00:55] wakes up</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == %&#123;</span><br><span class="line">             <span class="number">10</span> =&gt; [<span class="number">5</span>..<span class="number">24</span>, <span class="number">30</span>..<span class="number">54</span>, <span class="number">24</span>..<span class="number">28</span>] |&gt; Enum.reverse(),</span><br><span class="line">             <span class="number">99</span> =&gt; [<span class="number">40</span>..<span class="number">49</span>, <span class="number">36</span>..<span class="number">45</span>, <span class="number">45</span>..<span class="number">54</span>] |&gt; Enum.reverse(),</span><br><span class="line">             <span class="number">99334</span> =&gt; [<span class="number">45</span>..<span class="number">54</span>]</span><br><span class="line">           &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"find_sleep_constant"</span> <span class="keyword">do</span></span><br><span class="line">    assert find_sleep_constant(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           [1518-11-01 00:00] Guard #10 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-01 00:05] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-01 00:25] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-01 00:30] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-01 00:55] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-01 23:58] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-02 00:40] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-02 00:50] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-03 00:05] Guard #10 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-03 00:24] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-03 00:29] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-04 00:02] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-04 00:36] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-04 00:46] wakes up</span></span><br><span class="line"><span class="string">           [1518-11-05 00:03] Guard #99 begins shift</span></span><br><span class="line"><span class="string">           [1518-11-05 00:45] falls asleep</span></span><br><span class="line"><span class="string">           [1518-11-05 00:55] wakes up</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == <span class="number">240</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"parses line"</span> <span class="keyword">do</span></span><br><span class="line">    assert parse_line(<span class="string">"[1518-11-01 00:08] wakes up"</span>) == &#123;<span class="symbol">:wake</span>, <span class="number">8</span>&#125;</span><br><span class="line">    assert parse_line(<span class="string">"[1518-11-01 00:30] falls asleep"</span>) == &#123;<span class="symbol">:sleep</span>, <span class="number">30</span>&#125;</span><br><span class="line">    assert parse_line(<span class="string">"[1518-11-01 00:23] Guard #10 begins shift"</span>) == &#123;<span class="symbol">:start</span>, <span class="number">10</span>, <span class="number">23</span>&#125;</span><br><span class="line">    assert parse_line(<span class="string">"[1518-11-01 00:23] Guard #99 begins shift"</span>) == &#123;<span class="symbol">:start</span>, <span class="number">99</span>, <span class="number">23</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"file"</span> <span class="keyword">do</span></span><br><span class="line">    assert <span class="number">240</span> ==</span><br><span class="line">             find_sleep_constant(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">             [1518-11-01 00:00] Guard #10 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-01 00:05] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-01 00:25] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-01 00:30] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-01 00:55] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-01 23:58] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-02 00:40] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-02 00:50] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-03 00:05] Guard #10 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-03 00:24] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-03 00:29] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-04 00:02] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-04 00:36] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-04 00:46] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-05 00:03] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-05 00:45] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-05 00:55] wakes up</span></span><br><span class="line"><span class="string">             "</span><span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    assert File.read!(<span class="string">"./input.txt"</span>)</span><br><span class="line">           |&gt; find_sleep_constant == <span class="number">30630</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"sleepiest_guard_minute"</span> <span class="keyword">do</span></span><br><span class="line">    assert &#123;<span class="number">99</span>, <span class="number">45</span>&#125; ==</span><br><span class="line">             sleepiest_guard_minute(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">             [1518-11-01 00:00] Guard #10 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-01 00:05] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-01 00:25] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-01 00:30] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-01 00:55] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-01 23:58] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-02 00:40] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-02 00:50] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-03 00:05] Guard #10 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-03 00:24] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-03 00:29] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-04 00:02] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-04 00:36] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-04 00:46] wakes up</span></span><br><span class="line"><span class="string">             [1518-11-05 00:03] Guard #99 begins shift</span></span><br><span class="line"><span class="string">             [1518-11-05 00:45] falls asleep</span></span><br><span class="line"><span class="string">             [1518-11-05 00:55] wakes up</span></span><br><span class="line"><span class="string">             "</span><span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    assert &#123;guard, min&#125; =</span><br><span class="line">             File.read!(<span class="string">"./input.txt"</span>)</span><br><span class="line">             |&gt; sleepiest_guard_minute</span><br><span class="line"></span><br><span class="line">    assert guard * min == <span class="number">99</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/14/solution-to-advent-of-code-2018-day-4-in-elixir/" data-id="ck9vl2tvh008hzfwo41hjgrhu" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/14/solution-to-advent-of-code-2018-day-4-in-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/advent-of-code/">Advent of Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-easy-way-to-add-frozen-string-literal-magic-string-to-your-ruby-files" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/05/easy-way-to-add-frozen-string-literal-magic-string-to-your-ruby-files/" class="article-date">
  <time datetime="2018-12-05T15:19:29.000Z" itemprop="datePublished">2018-12-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/05/easy-way-to-add-frozen-string-literal-magic-string-to-your-ruby-files/">Easy way to add frozen_string_literal magic string to your ruby files</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">comm -23 \</span><br><span class="line">  &lt;(git ls-files|sort) \</span><br><span class="line">  &lt;(git grep -l <span class="string">'frozen_string_literal'</span>|sort) \</span><br><span class="line">  | grep -E <span class="string">'\.rb$'</span> \</span><br><span class="line">  | xargs -n1 sed -i <span class="string">'1s/^/# frozen_string_literal: true\n\n/'</span></span><br></pre></td></tr></table></figure>
<p>The code is pretty self explanatory, we get a list of all the files in our repo
and then remove the ones which already have the magic string and then filter it
to just the ruby files and finally adding the magic string to all the files.</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/05/easy-way-to-add-frozen-string-literal-magic-string-to-your-ruby-files/" data-id="ck9vl2ts8002tzfwowhqxi9dd" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/05/easy-way-to-add-frozen-string-literal-magic-string-to-your-ruby-files/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/magic-strings/">magic strings</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-solution-to-advent-of-code-2018-day-3-in-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/04/solution-to-advent-of-code-2018-day-3-in-elixir/" class="article-date">
  <time datetime="2018-12-04T11:23:15.000Z" itemprop="datePublished">2018-12-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/04/solution-to-advent-of-code-2018-day-3-in-elixir/">Solution to Advent of Code 2018 Day 3 in Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Solving Day 3 turned out to be a bit more challenging for me as I don’t usually
do these kind of exercises, Nevertheless it was fun!</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Rect</span></span> <span class="keyword">do</span></span><br><span class="line">  defstruct [<span class="symbol">:id</span>, <span class="symbol">:left</span>, <span class="symbol">:top</span>, <span class="symbol">:width</span>, <span class="symbol">:height</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">alias</span> __MODULE_<span class="number">_</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(spec) <span class="keyword">do</span></span><br><span class="line">    [id, dimensions] = String.split(spec, <span class="string">"@"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">    [coords, size] = String.split(dimensions, <span class="string">":"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line"></span><br><span class="line">    [left, top] = String.split(coords, <span class="string">","</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>) |&gt; Enum.map(&amp;parse_number/<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    [width, height] = String.split(size, <span class="string">"x"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>) |&gt; Enum.map(&amp;parse_number/<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    %Rect&#123;</span><br><span class="line">      <span class="symbol">id:</span> String.trim(id),</span><br><span class="line">      <span class="symbol">left:</span> left,</span><br><span class="line">      <span class="symbol">top:</span> top,</span><br><span class="line">      <span class="symbol">width:</span> width,</span><br><span class="line">      <span class="symbol">height:</span> height</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">parse_number</span></span>(str), <span class="symbol">do:</span> str |&gt; String.trim() |&gt; String.to_integer()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">order_horizontal</span></span>(r1, r2) <span class="keyword">do</span></span><br><span class="line">    if r1.left &lt; r2.left <span class="keyword">do</span></span><br><span class="line">      &#123;r1, r2&#125;</span><br><span class="line">    else</span><br><span class="line">      &#123;r2, r1&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">order_vertical</span></span>(r1, r2) <span class="keyword">do</span></span><br><span class="line">    if r1.top &lt; r2.top <span class="keyword">do</span></span><br><span class="line">      &#123;r1, r2&#125;</span><br><span class="line">    else</span><br><span class="line">      &#123;r2, r1&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">squares</span></span>(%Rect&#123;<span class="symbol">width:</span> w, <span class="symbol">height:</span> h&#125;) <span class="keyword">when</span> w &lt;= <span class="number">0</span> <span class="keyword">or</span> h &lt;= <span class="number">0</span>, <span class="symbol">do:</span> []</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">squares</span></span>(%Rect&#123;&#125; = r) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> x &lt;- r.left..(r.left + r.width - <span class="number">1</span>), y &lt;- r.top..(r.top + r.height - <span class="number">1</span>), <span class="symbol">do:</span> &#123;x, y&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Overlap</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">area</span></span>(spec) <span class="keyword">when</span> is_binary(spec) <span class="keyword">do</span></span><br><span class="line">    spec</span><br><span class="line">    |&gt; String.split(<span class="string">"\n"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">    |&gt; Enum.map(&amp;Rect.parse/<span class="number">1</span>)</span><br><span class="line">    |&gt; area</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">area</span></span>(rects, prev_squares \\ [])</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">area</span></span>([h | tl], prev_squares) <span class="keyword">do</span></span><br><span class="line">    squares =</span><br><span class="line">      tl</span><br><span class="line">      |&gt; Enum.map(<span class="keyword">fn</span> x -&gt; overlap(h, x) |&gt; Rect.squares() <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    area(tl, [squares | prev_squares])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">area</span></span>([], squares),</span><br><span class="line">    <span class="symbol">do:</span></span><br><span class="line">      squares</span><br><span class="line">      |&gt; List.flatten()</span><br><span class="line">      |&gt; Enum.uniq()</span><br><span class="line">      |&gt; Enum.count()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_non_overlap</span></span>(spec) <span class="keyword">when</span> is_binary(spec) <span class="keyword">do</span></span><br><span class="line">    rects =</span><br><span class="line">      spec</span><br><span class="line">      |&gt; String.split(<span class="string">"\n"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">      |&gt; Enum.map(&amp;Rect.parse/<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    find_non_overlap(rects, rects)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_non_overlap</span></span>([h | tl], all_rects) <span class="keyword">do</span></span><br><span class="line">    if all_rects</span><br><span class="line">       |&gt; Enum.filter(<span class="keyword">fn</span> x -&gt; x.id != h.id <span class="keyword">end</span>)</span><br><span class="line">       |&gt; Enum.all?(<span class="keyword">fn</span> x -&gt;</span><br><span class="line">         o = overlap(h, x)</span><br><span class="line">         o.width &lt;= <span class="number">0</span> || o.height &lt;= <span class="number">0</span></span><br><span class="line">       <span class="keyword">end</span>) <span class="keyword">do</span></span><br><span class="line">      h</span><br><span class="line">    else</span><br><span class="line">      find_non_overlap(tl, all_rects)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_non_overlap</span></span>([], <span class="number">_</span>), <span class="symbol">do:</span> raise(<span class="string">"Not found"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">overlap</span></span>(%Rect&#123;&#125; = r1, %Rect&#123;&#125; = r2) <span class="keyword">do</span></span><br><span class="line">    &#123;l, r&#125; = Rect.order_horizontal(r1, r2)</span><br><span class="line"></span><br><span class="line">    width = min(l.left + l.width - r.left, r.width)</span><br><span class="line"></span><br><span class="line">    &#123;t, b&#125; = Rect.order_vertical(r1, r2)</span><br><span class="line"></span><br><span class="line">    height = min(t.top + t.height - b.top, b.height)</span><br><span class="line"></span><br><span class="line">    %Rect&#123;</span><br><span class="line">      <span class="symbol">left:</span> r.left,</span><br><span class="line">      <span class="symbol">top:</span> b.top,</span><br><span class="line">      <span class="symbol">width:</span> width,</span><br><span class="line">      <span class="symbol">height:</span> height</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">OverlapTest</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line"></span><br><span class="line">  import Overlap</span><br><span class="line"></span><br><span class="line">  test <span class="string">"greets the world"</span> <span class="keyword">do</span></span><br><span class="line">    assert area(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           # 1 @ 1,3: 4x4</span></span><br><span class="line"><span class="string">           # 2 @ 3,1: 4x4</span></span><br><span class="line"><span class="string">           # 3 @ 5,5: 2x2</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    assert area(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           # 1 @ 1,3: 4x4</span></span><br><span class="line"><span class="string">           # 2 @ 3,1: 4x4</span></span><br><span class="line"><span class="string">           # 3 @ 1,3: 4x4</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    assert File.read!(<span class="string">"input.txt"</span>) |&gt; area == <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"overlap between 2 rects"</span> <span class="keyword">do</span></span><br><span class="line">    assert overlap(</span><br><span class="line">             %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">8</span>&#125;,</span><br><span class="line">             %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 2"</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">1</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">4</span>&#125;</span><br><span class="line">           ) == %Rect&#123;<span class="symbol">id:</span> <span class="keyword">nil</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">2</span>, <span class="symbol">height:</span> <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">    assert overlap(</span><br><span class="line">             %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">4</span>&#125;,</span><br><span class="line">             %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 3"</span>, <span class="symbol">left:</span> <span class="number">5</span>, <span class="symbol">top:</span> <span class="number">5</span>, <span class="symbol">width:</span> <span class="number">2</span>, <span class="symbol">height:</span> <span class="number">2</span>&#125;</span><br><span class="line">           ) == %Rect&#123;<span class="symbol">height:</span> <span class="number">2</span>, <span class="symbol">id:</span> <span class="keyword">nil</span>, <span class="symbol">left:</span> <span class="number">5</span>, <span class="symbol">top:</span> <span class="number">5</span>, <span class="symbol">width:</span> <span class="number">0</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"find_non_overlap"</span> <span class="keyword">do</span></span><br><span class="line">    assert find_non_overlap(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           # 1 @ 1,3: 4x4</span></span><br><span class="line"><span class="string">           # 2 @ 3,1: 4x4</span></span><br><span class="line"><span class="string">           # 3 @ 5,5: 2x2</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>).id == <span class="string">"# 3"</span></span><br><span class="line"></span><br><span class="line">    assert File.read!(<span class="string">"input.txt"</span>) |&gt; find_non_overlap == <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">RectTest</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line"></span><br><span class="line">  test <span class="string">"parse"</span> <span class="keyword">do</span></span><br><span class="line">    assert Rect.parse(<span class="string">"# 1 @ 1,3: 4x3"</span>) == %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"order_horizontal"</span> <span class="keyword">do</span></span><br><span class="line">    &#123;%&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>&#125;, %&#123;<span class="symbol">id:</span> <span class="string">"# 2"</span>&#125;&#125; =</span><br><span class="line">      Rect.order_horizontal(</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;,</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 2"</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    &#123;%&#123;<span class="symbol">id:</span> <span class="string">"# 4"</span>&#125;, %&#123;<span class="symbol">id:</span> <span class="string">"# 3"</span>&#125;&#125; =</span><br><span class="line">      Rect.order_horizontal(</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 3"</span>, <span class="symbol">left:</span> <span class="number">10</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;,</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 4"</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;</span><br><span class="line">      )</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"order_vertical"</span> <span class="keyword">do</span></span><br><span class="line">    &#123;%&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>&#125;, %&#123;<span class="symbol">id:</span> <span class="string">"# 2"</span>&#125;&#125; =</span><br><span class="line">      Rect.order_vertical(</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">1</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">1</span>&#125;,</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 2"</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    &#123;%&#123;<span class="symbol">id:</span> <span class="string">"# 4"</span>&#125;, %&#123;<span class="symbol">id:</span> <span class="string">"# 3"</span>&#125;&#125; =</span><br><span class="line">      Rect.order_vertical(</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 3"</span>, <span class="symbol">left:</span> <span class="number">10</span>, <span class="symbol">top:</span> <span class="number">10</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">10</span>&#125;,</span><br><span class="line">        %Rect&#123;<span class="symbol">id:</span> <span class="string">"# 4"</span>, <span class="symbol">left:</span> <span class="number">3</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">3</span>&#125;</span><br><span class="line">      )</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"squares"</span> <span class="keyword">do</span></span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">2</span>, <span class="symbol">height:</span> <span class="number">2</span>&#125;) == [</span><br><span class="line">             &#123;<span class="number">1</span>, <span class="number">3</span>&#125;,</span><br><span class="line">             &#123;<span class="number">1</span>, <span class="number">4</span>&#125;,</span><br><span class="line">             &#123;<span class="number">2</span>, <span class="number">3</span>&#125;,</span><br><span class="line">             &#123;<span class="number">2</span>, <span class="number">4</span>&#125;</span><br><span class="line">           ]</span><br><span class="line"></span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">0</span>, <span class="symbol">height:</span> <span class="number">0</span>&#125;) == []</span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">0</span>, <span class="symbol">height:</span> <span class="number">4</span>&#125;) == []</span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> <span class="number">0</span>&#125;) == []</span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> <span class="number">4</span>, <span class="symbol">height:</span> -<span class="number">4</span>&#125;) == []</span><br><span class="line">    assert Rect.squares(%Rect&#123;<span class="symbol">id:</span> <span class="string">"# 1"</span>, <span class="symbol">left:</span> <span class="number">1</span>, <span class="symbol">top:</span> <span class="number">3</span>, <span class="symbol">width:</span> -<span class="number">4</span>, <span class="symbol">height:</span> <span class="number">4</span>&#125;) == []</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/04/solution-to-advent-of-code-2018-day-3-in-elixir/" data-id="ck9vl2tvg008fzfwouffzx2je" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/04/solution-to-advent-of-code-2018-day-3-in-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/advent-of-code/">Advent of Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-solutions-to-advent-of-code-2018-day-2-in-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/02/solutions-to-advent-of-code-2018-day-2-in-elixir/" class="article-date">
  <time datetime="2018-12-02T20:07:39.000Z" itemprop="datePublished">2018-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/02/solutions-to-advent-of-code-2018-day-2-in-elixir/">Solutions to Advent of Code 2018 Day 2 in Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Day 2’s problem was a bit tricky for Elixir. Check out the commented code to see
how I tackled it:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env elixir</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day2</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">checksum</span></span>(ids) <span class="keyword">do</span></span><br><span class="line">    &#123;two_count, three_count&#125; =</span><br><span class="line">      ids</span><br><span class="line">      |&gt; String.split(<span class="string">"\n"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">      |&gt; Enum.reduce(&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, <span class="keyword">fn</span> id, &#123;two_count, three_count&#125; -&gt;</span><br><span class="line">        char_counts =</span><br><span class="line">          id</span><br><span class="line">          |&gt; String.graphemes()</span><br><span class="line">          |&gt; Enum.group_by(&amp; &amp;<span class="number">1</span>)</span><br><span class="line">          |&gt; Enum.map(<span class="keyword">fn</span> &#123;_c, vals&#125; -&gt; Enum.count(vals) <span class="keyword">end</span>)</span><br><span class="line">          |&gt; Enum.uniq()</span><br><span class="line"></span><br><span class="line">        &#123;incr_if_count(char_counts, two_count, <span class="number">2</span>), incr_if_count(char_counts, three_count, <span class="number">3</span>)&#125;</span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    two_count * three_count</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">incr_if_count</span></span>(counts, prev_count, matcher) <span class="keyword">do</span></span><br><span class="line">    if matcher <span class="keyword">in</span> counts <span class="keyword">do</span></span><br><span class="line">      prev_count + <span class="number">1</span></span><br><span class="line">    else</span><br><span class="line">      prev_count</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">find_common_boxes</span></span>(ids) <span class="keyword">do</span></span><br><span class="line">    ids =</span><br><span class="line">      ids</span><br><span class="line">      |&gt; String.split(<span class="string">"\n"</span>, <span class="symbol">trim:</span> <span class="keyword">true</span>)</span><br><span class="line">      |&gt; Enum.map(&amp;String.graphemes/<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    &#123;lhs, rhs&#125; = find_similar(ids)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    intersection(lhs, rhs)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">intersection</span></span>(lhs, rhs) <span class="keyword">do</span></span><br><span class="line">    Enum.zip(lhs, rhs)</span><br><span class="line">    |&gt; Enum.map(<span class="keyword">fn</span> &#123;l, l&#125; -&gt; l; <span class="number">_</span> -&gt; <span class="keyword">nil</span> <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Enum.filter(&amp; &amp;<span class="number">1</span>)</span><br><span class="line">    |&gt; Enum.join</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">find_similar</span></span>([lhs_id | ids]) <span class="keyword">do</span></span><br><span class="line">    matching_id =</span><br><span class="line">      Enum.find(ids, <span class="keyword">fn</span> rhs_id -&gt;</span><br><span class="line">        diff_count(lhs_id, rhs_id) == <span class="number">1</span></span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    if matching_id <span class="keyword">do</span></span><br><span class="line">      &#123;lhs_id, matching_id&#125;</span><br><span class="line">    else</span><br><span class="line">      find_similar(ids)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">diff_count</span></span>(lhs, rhs) <span class="keyword">do</span></span><br><span class="line">    Enum.zip(lhs, rhs)</span><br><span class="line">    |&gt; Enum.map(<span class="keyword">fn</span></span><br><span class="line">      &#123;x, x&#125; -&gt; <span class="number">0</span></span><br><span class="line">      <span class="number">_</span> -&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">    |&gt; Enum.sum()</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">ExUnit.start()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Day2Test</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> ExUnit.Case</span><br><span class="line"></span><br><span class="line">  import Day2</span><br><span class="line"></span><br><span class="line">  test <span class="string">"#checksum"</span> <span class="keyword">do</span></span><br><span class="line">    assert checksum(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           abcdef</span></span><br><span class="line"><span class="string">           bababc</span></span><br><span class="line"><span class="string">           abbcde</span></span><br><span class="line"><span class="string">           abcccd</span></span><br><span class="line"><span class="string">           aabcdd</span></span><br><span class="line"><span class="string">           abcdee</span></span><br><span class="line"><span class="string">           ababab</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == <span class="number">12</span></span><br><span class="line"></span><br><span class="line">    assert File.read!(<span class="string">"input.txt"</span>) |&gt; checksum == <span class="number">4693</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  test <span class="string">"#find_common_boxes"</span> <span class="keyword">do</span></span><br><span class="line">    assert find_common_boxes(<span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">           abcde</span></span><br><span class="line"><span class="string">           fghij</span></span><br><span class="line"><span class="string">           klmno</span></span><br><span class="line"><span class="string">           pqrst</span></span><br><span class="line"><span class="string">           fguij</span></span><br><span class="line"><span class="string">           axcye</span></span><br><span class="line"><span class="string">           wvxyz</span></span><br><span class="line"><span class="string">           "</span><span class="string">""</span>) == <span class="string">"fgij"</span></span><br><span class="line"></span><br><span class="line">    assert File.read!(<span class="string">"input.txt"</span>) |&gt; find_common_boxes == <span class="string">"pebjqsalrdnckzfihvtxysomg"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/02/solutions-to-advent-of-code-2018-day-2-in-elixir/" data-id="ck9vl2tvl008nzfwoiuc05eyc" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/02/solutions-to-advent-of-code-2018-day-2-in-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/advent-of-code/">Advent Of Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-solutions-to-advent-of-code-2018-day-1-in-elixir-ruby-rust-and-bash" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/01/solutions-to-advent-of-code-2018-day-1-in-elixir-ruby-rust-and-bash/" class="article-date">
  <time datetime="2018-12-01T21:56:11.000Z" itemprop="datePublished">2018-12-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/01/solutions-to-advent-of-code-2018-day-1-in-elixir-ruby-rust-and-bash/">Solutions to Advent of Code 2018 Day 1 in Elixir and Ruby</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Day 1 had a simple challenge, compute the sum of a few numbers and find out when
a prev frequency shows up again.</p>
<h2 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h2><h3 id="Elixir"><a href="#Elixir" class="headerlink" title="Elixir"></a>Elixir</h3><p>The elixir version is pretty straightforward, we create a stream using the
standard input which creates an entry per line, transform it into a number and
compute the sum:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env elixir</span></span><br><span class="line"><span class="comment"># run it as follows:</span></span><br><span class="line"><span class="comment"># $ ./elixir.exs &lt; input.txt</span></span><br><span class="line"><span class="comment"># 484</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read each line</span></span><br><span class="line">IO.stream(<span class="symbol">:stdio</span>, <span class="symbol">:line</span>)</span><br><span class="line">|&gt; Stream.map(<span class="keyword">fn</span> str -&gt;</span><br><span class="line">  &#123;n, <span class="string">""</span>&#125; = str |&gt; String.trim() |&gt; Integer.parse()</span><br><span class="line">  n</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line">|&gt; Enum.sum()</span><br><span class="line">|&gt; IO.puts()</span><br></pre></td></tr></table></figure>
<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>The ruby version is similar to the elixir version</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"><span class="comment"># run it as follows:</span></span><br><span class="line"><span class="comment"># $ ./ruby.rb &lt; input.txt</span></span><br><span class="line"><span class="comment"># 484</span></span><br><span class="line"></span><br><span class="line">puts ARGF.each_line</span><br><span class="line">         .map(&amp;<span class="symbol">:to_i</span>)</span><br><span class="line">         .sum</span><br></pre></td></tr></table></figure>
<h2 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h2><h3 id="Elixir-1"><a href="#Elixir-1" class="headerlink" title="Elixir"></a>Elixir</h3><p>This was a bit tricky as you may have to repeat the input multiple times to get
the answer. To do this in elixir, we use simple recursion if we aren’t able to
find a repeating frequency in the current iteration. Also, note that we are
using a <code>map</code> to store previous frequencies, I have seen folks use a list which
cause a huge impact on performance as lists don’t perform well for lookups
whereas maps really shine in these scenarios.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ChronalCalibration</span></span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">part_2</span></span>(input, start_freq \\ <span class="number">0</span>, prev_freqs \\ %&#123;<span class="number">0</span> =&gt; <span class="keyword">true</span>&#125;) <span class="keyword">do</span></span><br><span class="line">    res =</span><br><span class="line">      input</span><br><span class="line">      |&gt; String.split(<span class="string">"\n"</span>)</span><br><span class="line">      |&gt; Enum.reduce_while(&#123;start_freq, prev_freqs&#125;, <span class="keyword">fn</span> x, &#123;freq, prev_freqs&#125; -&gt;</span><br><span class="line">        &#123;i, <span class="string">""</span>&#125; = Integer.parse(x)</span><br><span class="line">        freq = i + freq</span><br><span class="line"></span><br><span class="line">        if prev_freqs[freq] <span class="keyword">do</span></span><br><span class="line">          &#123;<span class="symbol">:halt</span>, &#123;<span class="symbol">:succ</span>, freq&#125;&#125;</span><br><span class="line">        else</span><br><span class="line">          &#123;<span class="symbol">:cont</span>, &#123;freq, Map.put(prev_freqs, freq, <span class="keyword">true</span>)&#125;&#125;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> res <span class="keyword">do</span></span><br><span class="line">      &#123;<span class="symbol">:succ</span>, freq&#125; -&gt; freq</span><br><span class="line">      &#123;freq, prev_freqs&#125; -&gt; part_2(input, freq, prev_freqs)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">IO.puts File.read!(<span class="string">"input.txt"</span>) |&gt; ChronalCalibration.part_2</span><br></pre></td></tr></table></figure>
<h3 id="Ruby-1"><a href="#Ruby-1" class="headerlink" title="Ruby"></a>Ruby</h3><p>The Ruby implementation is similar to the Elixir implementation.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeating_freq</span></span></span><br><span class="line">  input = File.read(<span class="string">"input.txt"</span>)</span><br><span class="line">  prev_freqs = &#123; <span class="number">0</span> =&gt; <span class="literal">true</span> &#125;</span><br><span class="line">  freq = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  loop <span class="keyword">do</span></span><br><span class="line">    input</span><br><span class="line">      .lines</span><br><span class="line">      .each <span class="keyword">do</span> <span class="params">|curr|</span></span><br><span class="line">        freq += curr.to_i</span><br><span class="line">        <span class="keyword">return</span> freq <span class="keyword">if</span> prev_freqs[freq]</span><br><span class="line">        prev_freqs[freq] = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">puts repeating_freq()</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/12/01/solutions-to-advent-of-code-2018-day-1-in-elixir-ruby-rust-and-bash/" data-id="ck9vl2tvk008lzfwoktj0fu6t" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/12/01/solutions-to-advent-of-code-2018-day-1-in-elixir-ruby-rust-and-bash/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/advent-of-code/">Advent of Code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">Ruby</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-get-an-md5-hash-of-your-request-using-a-plug-and-phoenix" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/22/how-to-get-an-md5-hash-of-your-request-using-a-plug-and-phoenix/" class="article-date">
  <time datetime="2018-11-22T14:42:06.000Z" itemprop="datePublished">2018-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/22/how-to-get-an-md5-hash-of-your-request-using-a-plug-and-phoenix/">How to get an MD5 hash of your request using a Plug and Phoenix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In a recent project, I had to implement idempotent API endpoints in a Phoenix
application. And as a part of this, I had to store the MD5 hash of each request
body along with its idempotency key and other request data. And the latest Plug
makes this easier <a href="https://github.com/elixir-plug/plug/pull/698" target="_blank" rel="noopener">thanks to this PR</a>.</p>
<p>So, let us take a step back and see what is required. We want to plug into the
request pipeline, read the body, compute its md5 hash and store it in a private
variable on the connection. Before <a href="https://github.com/elixir-plug/plug/blob/v1.6/CHANGELOG.md#v151-2018-05-17" target="_blank" rel="noopener">Plug
1.5.1</a>,
if you wanted to read the requested body you had to duplicate your request
  parsers as they directly read from the connection using <code>Plug.Conn.read_body</code>
  which read the content, parsed it and discarded it. If you ended up putting
  your plug before the parsers and read the body, the JSON parser would fail to
  see any request data as the request would already have been read.</p>
<p>To work around this limitation a new option called <code>body_reader</code> was added to
the <code>Plug.Parsers</code> plug. This allows you to get in the middle of the parser and
the connection and have custom code which can read the request body, cache it
and hand over the request body to the parsers which ends up in a clean
implementation. So, let us take a look at the code that is required to add MD5
hashing to our requests.</p>
<p>The first thing we need is a custom request body reader which can be used by our
parsers. From the example in the Plug documentation, it can be as simple as the
code below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">BodyReader</span></span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read_body</span></span>(conn, opts) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># read the body from the connection</span></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, body, conn&#125; = Plug.Conn.read_body(conn, opts)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># compute our md5 hash</span></span><br><span class="line">    md5sum = <span class="symbol">:crypto</span>.hash(<span class="symbol">:md5</span>, body) |&gt; Base.encode16()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># shove the md5sum into a private key on the connection</span></span><br><span class="line">    conn = Plug.Conn.put_private(conn, <span class="symbol">:md5sum</span>, md5sum)</span><br><span class="line"></span><br><span class="line">    &#123;<span class="symbol">:ok</span>, body, conn&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The above module has a <code>read_body</code> function which takes a connection, reads
the request body, computes its md5 hash and shoves it into a private key on the
connection and returns the body and connection to the parsers to pass them
along.</p>
<p>Once we have this custom reader, we just need to configure our parsers to use
this by changing our endpoint to have the following code:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plug Plug.Parsers,</span><br><span class="line">  <span class="symbol">parsers:</span> [<span class="symbol">:urlencoded</span>, <span class="symbol">:multipart</span>, <span class="symbol">:json</span>],</span><br><span class="line">  <span class="symbol">pass:</span> [<span class="string">"*/*"</span>],</span><br><span class="line">  <span class="symbol">body_reader:</span> &#123;BodyReader, <span class="symbol">:read_body</span>, []&#125;,</span><br><span class="line">  <span class="symbol">json_decoder:</span> Phoenix.json_library()</span><br></pre></td></tr></table></figure>
<p>Once you set this up your actions can access the md5sum of a request using
<code>conn.private[:md5sum]</code>. And that is all you need to compute the MD5 sum of your
requests.</p>
<p>The same technique can be used to authenticate webhook requests from <a href="https://developer.github.com/webhooks/securing/" target="_blank" rel="noopener">GitHub</a>,
<a href="https://www.dropbox.com/developers/reference/webhooks" target="_blank" rel="noopener">Dropbox</a> and other services which sign their requests with an HMAC key.</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/11/22/how-to-get-an-md5-hash-of-your-request-using-a-plug-and-phoenix/" data-id="ck9vl2ttc004ezfwo0uk63xtz" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/11/22/how-to-get-an-md5-hash-of-your-request-using-a-plug-and-phoenix/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hmac/">HMAC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/md5/">MD5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/phoenix/">Phoenix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/plug/">Plug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sign-request/">Sign Request</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-7-ways-of-doing-fizz-buzz-in-elixir-and-other-clickbaity-stuff" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/06/7-ways-of-doing-fizz-buzz-in-elixir-and-other-clickbaity-stuff/" class="article-date">
  <time datetime="2018-07-06T10:58:36.000Z" itemprop="datePublished">2018-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/06/7-ways-of-doing-fizz-buzz-in-elixir-and-other-clickbaity-stuff/">7 ways of doing Fizz Buzz in Elixir and other clickbaity stuff</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Every developer “worth their salt” knows how to implement FizzBuzz, It is a program which prints the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">defmodule FizzBuzz do</span><br><span class="line">  def run(count) do</span><br><span class="line">    Enum.map(1..20, &amp;fizzbuzz/1)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def fizzbuzz(n) do</span><br><span class="line">    # ...</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line">iex&gt; FizzBuzz.run(16)</span><br><span class="line"># =&gt; 1, 2, Fizz, 4, Buzz, Fizz, 7, 8, Fizz, Buzz, 11, Fizz, 13, 14, FizzBuzz, 16</span><br></pre></td></tr></table></figure>
<p>Let us see a few possible ways to do this in Elixir!</p>
<h2 id="1-Use-if"><a href="#1-Use-if" class="headerlink" title="1. Use if"></a>1. Use if</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_if</span></span>(n) <span class="keyword">do</span></span><br><span class="line">  if rem(n, <span class="number">3</span>) == <span class="number">0</span> <span class="keyword">and</span> rem(n, <span class="number">5</span>) == <span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">    <span class="string">"FizzBuzz"</span></span><br><span class="line">  else</span><br><span class="line">    if rem(n, <span class="number">3</span>) == <span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">      <span class="string">"Fizz"</span></span><br><span class="line">    else</span><br><span class="line">      if rem(n, <span class="number">5</span>) == <span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">        <span class="string">"Buzz"</span></span><br><span class="line">      else</span><br><span class="line">        n</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>That is some real ugly code, it is exacerbated by the fact that Elixir doesn’t allow early returns.</p>
<h2 id="2-Use-cond"><a href="#2-Use-cond" class="headerlink" title="2. Use cond"></a>2. Use cond</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_cond1</span></span>(n) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">cond</span> <span class="keyword">do</span></span><br><span class="line">    rem(n, <span class="number">3</span>) == <span class="number">0</span> <span class="keyword">and</span> rem(n, <span class="number">5</span>) == <span class="number">0</span> -&gt; <span class="string">"FizzBuzz"</span></span><br><span class="line">    rem(n, <span class="number">3</span>) == <span class="number">0</span> -&gt; <span class="string">"Fizz"</span></span><br><span class="line">    rem(n, <span class="number">5</span>) == <span class="number">0</span> -&gt; <span class="string">"Buzz"</span></span><br><span class="line">    <span class="keyword">true</span> -&gt; n</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This is a huge improvement, I really think this captures the problem the solution in a very readable way.</p>
<h2 id="3-Use-cond-with-better-predicates"><a href="#3-Use-cond-with-better-predicates" class="headerlink" title="3. Use cond with better predicates"></a>3. Use cond with better predicates</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divisible_by_3?</span></span>(n), <span class="symbol">do:</span> rem(n, <span class="number">3</span>) == <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divisible_by_5?</span></span>(n), <span class="symbol">do:</span> rem(n, <span class="number">5</span>) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_cond2</span></span>(n) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">cond</span> <span class="keyword">do</span></span><br><span class="line">    divisible_by_3?(n) <span class="keyword">and</span> divisible_by_5?(n) -&gt; <span class="string">"FizzBuzz"</span></span><br><span class="line">    divisible_by_3?(n) -&gt; <span class="string">"Fizz"</span></span><br><span class="line">    divisible_by_5?(n) -&gt; <span class="string">"Buzz"</span></span><br><span class="line">    <span class="keyword">true</span> -&gt; n</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Using separate predicates improves the readability further.</p>
<h2 id="4-Use-case"><a href="#4-Use-case" class="headerlink" title="4. Use case"></a>4. Use case</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_case</span></span>(n) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> &#123;rem(n, <span class="number">3</span>), rem(n,<span class="number">5</span>)&#125; <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">0</span>&#125; -&gt; <span class="string">"FizzBuzz"</span></span><br><span class="line">    &#123;<span class="number">0</span>, <span class="number">_</span>&#125; -&gt; <span class="string">"Fizz"</span></span><br><span class="line">    &#123;<span class="number">_</span>, <span class="number">0</span>&#125; -&gt; <span class="string">"Buzz"</span></span><br><span class="line">    <span class="number">_</span> -&gt; n</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>This is a concise chunk of code but isn’t as readable as the one that uses cond.</p>
<h2 id="5-Use-pattern-matching-in-functions"><a href="#5-Use-pattern-matching-in-functions" class="headerlink" title="5. Use pattern matching in functions"></a>5. Use pattern matching in functions</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun1</span></span>(n) <span class="keyword">do</span></span><br><span class="line">  fb_fun(n, rem(n, <span class="number">3</span>), rem(n, <span class="number">5</span>))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun</span></span>(<span class="number">_</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="symbol">do:</span> <span class="string">"FizzBuzz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun</span></span>(<span class="number">_</span>, <span class="number">0</span>, <span class="number">_</span>), <span class="symbol">do:</span> <span class="string">"Fizz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun</span></span>(<span class="number">_</span>, <span class="number">_</span>, <span class="number">0</span>), <span class="symbol">do:</span> <span class="string">"Buzz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun</span></span>(n, <span class="number">_</span>, <span class="number">_</span>), <span class="symbol">do:</span> n</span><br></pre></td></tr></table></figure>
<p>I think this is actually less readable than the one that uses case as the logic.</p>
<h2 id="6-Use-guard-clauses-in-functions"><a href="#6-Use-guard-clauses-in-functions" class="headerlink" title="6. Use guard clauses in functions"></a>6. Use guard clauses in functions</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def fb_fun2(n) when rem(n, 3) == 0 and rem(n, 5) == 0, do: &quot;FizzBuzz&quot;</span><br><span class="line">def fb_fun2(n) when rem(n, 3) == 0, do: &quot;Fizz&quot;</span><br><span class="line">def fb_fun2(n) when rem(n, 5) == 0, do: &quot;Buzz&quot;</span><br><span class="line">def fb_fun2(n), do: n</span><br></pre></td></tr></table></figure>
<p>This feels like an improvement to the previous implementation readability wise.</p>
<h2 id="7-Use-custom-made-guard-clauses-in-functions"><a href="#7-Use-custom-made-guard-clauses-in-functions" class="headerlink" title="7. Use custom made guard clauses in functions"></a>7. Use custom made guard clauses in functions</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">defguard is_divisible_by_3(n) <span class="keyword">when</span> rem(n, <span class="number">3</span>) == <span class="number">0</span></span><br><span class="line">defguard is_divisible_by_5(n) <span class="keyword">when</span> rem(n, <span class="number">5</span>) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun3</span></span>(n) <span class="keyword">when</span> is_divisible_by_3(n) <span class="keyword">and</span> is_divisible_by_5(n), <span class="symbol">do:</span> <span class="string">"FizzBuzz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun3</span></span>(n) <span class="keyword">when</span> is_divisible_by_3(n), <span class="symbol">do:</span> <span class="string">"Fizz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun3</span></span>(n) <span class="keyword">when</span> is_divisible_by_5(n), <span class="symbol">do:</span> <span class="string">"Buzz"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fb_fun3</span></span>(n), <span class="symbol">do:</span> n</span><br></pre></td></tr></table></figure>
<p>I like this one a lot, it feels very terse and reads like a mathematical equation.</p>
<p>Which version do you personally find more readable? I feel like the last one
and the implementation using cond are the more readable versions.</p>
<p>Here is the piece of code containing all implementations:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">defmodule Fizzbuzz do</span><br><span class="line">  def fb_if(n) do</span><br><span class="line">    if rem(n, 3) == 0 and rem(n, 5) == 0 do</span><br><span class="line">      &quot;FizzBuzz&quot;</span><br><span class="line">    else</span><br><span class="line">      if rem(n, 3) == 0 do</span><br><span class="line">        &quot;Fizz&quot;</span><br><span class="line">      else</span><br><span class="line">        if rem(n, 5) == 0 do</span><br><span class="line">          &quot;Buzz&quot;</span><br><span class="line">        else</span><br><span class="line">          n</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def fb_cond1(n) do</span><br><span class="line">    cond do</span><br><span class="line">      rem(n, 3) == 0 and rem(n, 5) == 0 -&gt; &quot;FizzBuzz&quot;</span><br><span class="line">      rem(n, 3) == 0 -&gt; &quot;Fizz&quot;</span><br><span class="line">      rem(n, 5) == 0 -&gt; &quot;Buzz&quot;</span><br><span class="line">      true -&gt; n</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def divisible_by_3?(n), do: rem(n, 3) == 0</span><br><span class="line">  def divisible_by_5?(n), do: rem(n, 5) == 0</span><br><span class="line"></span><br><span class="line">  def fb_cond2(n) do</span><br><span class="line">    cond do</span><br><span class="line">      divisible_by_3?(n) and divisible_by_5?(n) -&gt; &quot;FizzBuzz&quot;</span><br><span class="line">      divisible_by_3?(n) -&gt; &quot;Fizz&quot;</span><br><span class="line">      divisible_by_5?(n) -&gt; &quot;Buzz&quot;</span><br><span class="line">      true -&gt; n</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def fb_case(n) do</span><br><span class="line">    case &#123;rem(n, 3), rem(n, 5)&#125; do</span><br><span class="line">      &#123;0, 0&#125; -&gt; &quot;FizzBuzz&quot;</span><br><span class="line">      &#123;0, _&#125; -&gt; &quot;Fizz&quot;</span><br><span class="line">      &#123;_, 0&#125; -&gt; &quot;Buzz&quot;</span><br><span class="line">      _ -&gt; n</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def fb_fun1(n) do</span><br><span class="line">    fb_fun1(n, rem(n, 3), rem(n, 5))</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def fb_fun1(_, 0, 0), do: &quot;FizzBuzz&quot;</span><br><span class="line">  def fb_fun1(_, 0, _), do: &quot;Fizz&quot;</span><br><span class="line">  def fb_fun1(_, _, 0), do: &quot;Buzz&quot;</span><br><span class="line">  def fb_fun1(n, _, _), do: n</span><br><span class="line"></span><br><span class="line">  def fb_fun2(n) when rem(n, 3) == 0 and rem(n, 5) == 0, do: &quot;FizzBuzz&quot;</span><br><span class="line">  def fb_fun2(n) when rem(n, 3) == 0, do: &quot;Fizz&quot;</span><br><span class="line">  def fb_fun2(n) when rem(n, 5) == 0, do: &quot;Buzz&quot;</span><br><span class="line">  def fb_fun2(n), do: n</span><br><span class="line"></span><br><span class="line">  defguard is_divisible_by_3(n) when rem(n, 3) == 0</span><br><span class="line">  defguard is_divisible_by_5(n) when rem(n, 5) == 0</span><br><span class="line"></span><br><span class="line">  def fb_fun3(n) when is_divisible_by_3(n) and is_divisible_by_5(n), do: &quot;FizzBuzz&quot;</span><br><span class="line">  def fb_fun3(n) when is_divisible_by_3(n), do: &quot;Fizz&quot;</span><br><span class="line">  def fb_fun3(n) when is_divisible_by_5(n), do: &quot;Buzz&quot;</span><br><span class="line">  def fb_fun3(n), do: n</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ExUnit.start()</span><br><span class="line"></span><br><span class="line">defmodule FizzbuzzTest do</span><br><span class="line">  use ExUnit.Case</span><br><span class="line"></span><br><span class="line">  @run_20_out [</span><br><span class="line">    1,</span><br><span class="line">    2,</span><br><span class="line">    &quot;Fizz&quot;,</span><br><span class="line">    4,</span><br><span class="line">    &quot;Buzz&quot;,</span><br><span class="line">    &quot;Fizz&quot;,</span><br><span class="line">    7,</span><br><span class="line">    8,</span><br><span class="line">    &quot;Fizz&quot;,</span><br><span class="line">    &quot;Buzz&quot;,</span><br><span class="line">    11,</span><br><span class="line">    &quot;Fizz&quot;,</span><br><span class="line">    13,</span><br><span class="line">    14,</span><br><span class="line">    &quot;FizzBuzz&quot;,</span><br><span class="line">    16,</span><br><span class="line">    17,</span><br><span class="line">    &quot;Fizz&quot;,</span><br><span class="line">    19,</span><br><span class="line">    &quot;Buzz&quot;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  def assert_fizzbuzz(fun) do</span><br><span class="line">    assert 1..20 |&gt; Enum.map(fn x -&gt; apply(Fizzbuzz, fun, [x]) end) == @run_20_out</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  test &quot;run&quot; do</span><br><span class="line">    assert_fizzbuzz(:fb_if)</span><br><span class="line">    assert_fizzbuzz(:fb_cond1)</span><br><span class="line">    assert_fizzbuzz(:fb_cond2)</span><br><span class="line">    assert_fizzbuzz(:fb_case)</span><br><span class="line">    assert_fizzbuzz(:fb_fun1)</span><br><span class="line">    assert_fizzbuzz(:fb_fun2)</span><br><span class="line">    assert_fizzbuzz(:fb_fun3)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/07/06/7-ways-of-doing-fizz-buzz-in-elixir-and-other-clickbaity-stuff/" data-id="ck9vl2trf001dzfwod3ggrmf9" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/07/06/7-ways-of-doing-fizz-buzz-in-elixir-and-other-clickbaity-stuff/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fizzbuzz/">FizzBuzz</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-manage-ginormous-exvcr-cassettes" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/18/how-to-manage-ginormous-exvcr-cassettes/" class="article-date">
  <time datetime="2018-06-18T08:39:08.000Z" itemprop="datePublished">2018-06-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/18/how-to-manage-ginormous-exvcr-cassettes/">How to manage ginormous ExVCR cassettes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://github.com/parroty/exvcr" target="_blank" rel="noopener">ExVCR</a> is an awesome elixir package which
helps you create repeatable integration tests. It works by saving the requests
and responses you make to external services, in json files called cassettes. These
cassettes are created the first time you run the tests. Here is an example from
one of my projects:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">X</span></span>.AuthControllerTest <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> X.ConnCase</span><br><span class="line">  <span class="keyword">use</span> ExVCR.Mock, <span class="symbol">adapter:</span> ExVCR.Adapter.Hackney</span><br><span class="line"></span><br><span class="line">  test <span class="string">"google redirect creates the user"</span>, %&#123;<span class="symbol">conn:</span> conn&#125; <span class="keyword">do</span></span><br><span class="line">    conn =</span><br><span class="line">      use_cassette <span class="string">"google_oauth_challenge"</span> <span class="keyword">do</span></span><br><span class="line">        conn</span><br><span class="line">        |&gt; get(</span><br><span class="line">          <span class="string">"/auth/google/callback?code=....................."</span></span><br><span class="line">        )</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    assert ...</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>The first time I run this test it creates a file at <code>fixture/vcr_cassettes/google_oauth_challenge.json</code>.
This contains the request and response data from this test. Now, whenever you rerun
this test it just loads this request and response data and replays the response if the request
matches the saved request. So, your tests will pass even when you don’t have network connectivity!</p>
<p>This is all nice as long as you have small responses. However, when you need to do this
for responses whose size is in MBs you run into a few issues:</p>
<ol>
<li>Your tests become slower.</li>
<li>You don’t want to haul around MBs of fixtures in your source control (you must check in the cassettes i.e. the <code>fixture/</code> directory).</li>
</ol>
<p>I recently ran into this situation with one of my projects where I was downloading
a gzipped csv file which was ~50MB. The way I fixed it is:</p>
<ol>
<li>Let ExVCR record the cassettes with all the large data.</li>
<li>Download the same response from outside using curl.</li>
<li>Take a tiny sample of the response data</li>
<li>Replace the <code>response.body</code> in the cassette with my sample response data</li>
</ol>
<p>This fixes the slow tests and also reduces the size of cassettes.</p>
<p>Another thing to remember is if your response is binary and not a valid string, ExVCR stores it differently.
Its <a href="https://github.com/parroty/exvcr/blob/master/lib/exvcr/json.ex#L22" target="_blank" rel="noopener">json serializer</a> runs binary
data through the following functions</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.body</span><br><span class="line">|&gt; <span class="symbol">:erlang</span>.term_to_binary()</span><br><span class="line">|&gt; Base.encode64()</span><br></pre></td></tr></table></figure>
<p>So, if you have gzipped (or any other binary) data, load it into IEx from step <em>2</em> above and run it through
the same functions as above and use this data to replace the <code>response.body</code>. You can also skip <em>2</em>
and use the data from your large cassette before trimming it down by running it through:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cassette = File.read!(&quot;fixture/vcr_cassettes/cassette.json&quot;) |&gt; Poison.decode! |&gt; hd</span><br><span class="line">cassette[&quot;response&quot;][&quot;body&quot;]</span><br><span class="line">|&gt; Base.decode64!</span><br><span class="line">|&gt; :erlang.binary_to_term # you&apos;ll have the raw response binary data at this point</span><br><span class="line">|&gt; :zlib.gunzip # if your response is gzipped you&apos;ll need this to extract the actual data</span><br></pre></td></tr></table></figure>
<p>P.S
My editor froze while trying to edit such a large cassette, so I used jq to remove
the large body keys from the response using the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &apos;walk(if type == &quot;object&quot; and has(&quot;body&quot;) then del(.body) else . end)&apos; mycassette.json  &gt; cassette_without_body.json</span><br></pre></td></tr></table></figure>
<p>To get the above working you need jq &gt; 1.5 and the following in your <code>~/.jq</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Apply f to composite entities recursively, and to atoms</span><br><span class="line">def walk(f):</span><br><span class="line">  . as $in</span><br><span class="line">  | if type == &quot;object&quot; then</span><br><span class="line">      reduce keys_unsorted[] as $key</span><br><span class="line">        ( &#123;&#125;; . + &#123; ($key):  ($in[$key] | walk(f)) &#125; ) | f</span><br><span class="line">  elif type == &quot;array&quot; then map( walk(f) ) | f</span><br><span class="line">  else f</span><br><span class="line">  end;</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/06/18/how-to-manage-ginormous-exvcr-cassettes/" data-id="ck9vl2ttk004tzfwoiy0170rr" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/06/18/how-to-manage-ginormous-exvcr-cassettes/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassette/">Cassette</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exvcr/">ExVCR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/large/">Large</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-your-elixir-bucket-for-debugging" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/17/your-elixir-bucket-for-debugging/" class="article-date">
  <time datetime="2018-05-17T12:52:02.000Z" itemprop="datePublished">2018-05-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/17/your-elixir-bucket-for-debugging/">Your Elixir bucket for debugging</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>While debugging and experimenting with apis in javascript, I usually set a variable
on <code>window</code> and then play with it in the console.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> channel = socket.channel( <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.channel = channel;</span><br></pre></td></tr></table></figure>
<p>Once the above code is set, I can just jump into the console and start pushing
messages to the channel and discover how it all works by poking it around.</p>
<p>This led me to think about how this can be done in Elixir. And, in one of my
recent projects, I was spawning a few processes and wanted to get their pids
to play around by sending messages to them. And I just thought why not use <code>ets</code>
as global bucket to shove stuff into. Here is my solution:</p>
<p>Just create an <code>ets</code> table in your <code>.iex.exs</code></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .iex.exs</span></span><br><span class="line"><span class="comment"># A tmp bucket which you can push stuff into and analyze from iex</span></span><br><span class="line"><span class="symbol">:ets</span>.new(<span class="symbol">:tmp</span>, [<span class="symbol">:named_table</span>, <span class="symbol">:public</span>])</span><br></pre></td></tr></table></figure>
<p>And, wherever you want, just push things into this table:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in my app</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">websocket_info</span></span>(_msg, _conn, state) <span class="keyword">do</span></span><br><span class="line">  <span class="symbol">:ets</span>.insert(<span class="symbol">:tmp</span>, &#123;<span class="keyword">self</span>(), <span class="symbol">:ok</span>&#125;)</span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>Once you have that, you can start poking and prodding your processes/variables</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iex&gt;</span></span><br><span class="line"><span class="symbol">:ets</span>.tab2list(<span class="symbol">:tmp</span>)</span><br></pre></td></tr></table></figure>
<p>Hope this helps you while debugging your Elixir apps :D</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/05/17/your-elixir-bucket-for-debugging/" data-id="ck9vl2tw0009hzfwonzkx06fx" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/05/17/your-elixir-bucket-for-debugging/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debug/">debug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ets/">ets</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iex/">iex</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-implement-your-own-timer-sleep-in-elixir" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/11/how-to-implement-your-own-timer-sleep-in-elixir/" class="article-date">
  <time datetime="2018-05-11T16:41:17.000Z" itemprop="datePublished">2018-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/11/how-to-implement-your-own-timer-sleep-in-elixir/">How to implement your own :timer.sleep in Elixir</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Elixir has <code>:timer.sleep(ms)</code>, a function which allows you to pause a process’s execution for an
arbitrary number of milliseconds.</p>
<p>We can implement the same using messages and a timeout in the following ways.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SleepTimeout</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sleep</span></span>(milliseconds) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># use a receive block with no matching blocks and an after block</span></span><br><span class="line">    <span class="comment"># which times out after the input number of milliseconds</span></span><br><span class="line">    receive <span class="keyword">do</span></span><br><span class="line">    after</span><br><span class="line">      milliseconds -&gt;</span><br><span class="line">        <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">SleepMsg</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sleep</span></span>(milliseconds) <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># create a unique ref, so that we don't stop on any random `:timeout` message.</span></span><br><span class="line">    ref = make_ref()</span><br><span class="line">    <span class="comment"># schedule a message to be sent to ourselves in the input number of milliseconds</span></span><br><span class="line">    Process.send_after(<span class="keyword">self</span>(), &#123;<span class="symbol">:timeout</span>, ref&#125;, milliseconds)</span><br><span class="line"></span><br><span class="line">    receive <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># wait for our message to arrive</span></span><br><span class="line">      &#123;<span class="symbol">:timeout</span>, ^ref&#125; -&gt;</span><br><span class="line">        <span class="symbol">:ok</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">&#123;microseconds, <span class="number">_</span>&#125; = <span class="symbol">:timer</span>.tc(<span class="keyword">fn</span> -&gt; SleepTimeout.sleep(<span class="number">1000</span>) <span class="keyword">end</span>)</span><br><span class="line">IO.puts(<span class="string">"slept for <span class="subst">#&#123;round(microseconds / <span class="number">1000</span>)&#125;</span> microseconds"</span>)</span><br><span class="line"><span class="comment"># =&gt; slept for 1000 microseconds</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;microseconds, <span class="number">_</span>&#125; = <span class="symbol">:timer</span>.tc(<span class="keyword">fn</span> -&gt; SleepMsg.sleep(<span class="number">1000</span>) <span class="keyword">end</span>)</span><br><span class="line">IO.puts(<span class="string">"slept for <span class="subst">#&#123;round(microseconds / <span class="number">1000</span>)&#125;</span> microseconds"</span>)</span><br><span class="line"><span class="comment"># =&gt; slept for 1001 microseconds</span></span><br></pre></td></tr></table></figure>
<p>You may ask, what is the frigging point of all of this when we have <code>:timer.sleep</code>?
Well, there is no point. This was just a fun little exercise :D</p>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/05/11/how-to-implement-your-own-timer-sleep-in-elixir/" data-id="ck9vl2ttf004jzfwo5j8j2fjf" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/05/11/how-to-implement-your-own-timer-sleep-in-elixir/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elixir/">Elixir</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sleep/">Sleep</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-how-to-setup-your-hexo-blog-to-be-automatically-published-using-travis-ci" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/how-to-setup-your-hexo-blog-to-be-automatically-published-using-travis-ci/" class="article-date">
  <time datetime="2018-05-09T15:31:27.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/how-to-setup-your-hexo-blog-to-be-automatically-published-using-travis-ci/">How to setup your hexo blog to be automatically published using Travis CI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://blog.github.com/2018-05-01-github-pages-custom-domains-https/" target="_blank" rel="noopener">GitHub Pages has recently finished one of the long standing feature requests of
allowing SSL on custom domains!</a>.
I have it enabled on my blog (<a href="https://minhajuddin.com)">https://minhajuddin.com)</a>. Yay! However, I have not
been able to publish any new blog posts because the effort required to publish
a new post is a bit too much! The previous service that I had used to auto publish
was shut down. And looking at the alternatives, <a href="https://travis-ci.org/minhajuddin/blog.minhajuddin.com" target="_blank" rel="noopener">Travis CI</a> looked great.
I use it for a few of my other projects.</p>
<p>Here is the <code>.travis.yml</code> with a few slight modifications from: <a href="https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml" target="_blank" rel="noopener">https://github.com/jkeylu/deploy-hexo-site-by-travis-ci/blob/master/_travis.yml</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># Deploy hexo site by travis-ci</span><br><span class="line"># https://github.com/jkeylu/deploy-hexo-site-by-travis-ci</span><br><span class="line"># 1. Copy this file to the root of your repository, then rename it to &apos;.travis.yml&apos;</span><br><span class="line"># 2. Replace &apos;YOUR NAME&apos; and &apos;YOUR EMAIL&apos; at line 29</span><br><span class="line"># 3. Add an Environment Variable &apos;DEPLOY_REPO&apos;</span><br><span class="line">#     1. Generate github access token on https://github.com/settings/applications#personal-access-tokens</span><br><span class="line">#     2. Add an Environment Variable on https://travis-ci.org/&#123;github username&#125;/&#123;repository name&#125;/settings/env_vars</span><br><span class="line">#         Variable Name: DEPLOY_REPO</span><br><span class="line">#         Variable Value: https://&#123;githb access token&#125;@github.com/&#123;github username&#125;/&#123;repository name&#125;.git</span><br><span class="line">#         Example: DEPLOY_REPO=https://6b75cfe9836f56e6d21187622730889874476c23@github.com/jkeylu/test-hexo-on-travis-ci.git</span><br><span class="line"># 4. Make sure Travis is configured to hide your Variable, else others will see your access token and can mess with all your repos.</span><br><span class="line"></span><br><span class="line">language: node_js</span><br><span class="line">node_js:</span><br><span class="line">- &quot;9&quot;</span><br><span class="line"></span><br><span class="line">branches:</span><br><span class="line">  only:</span><br><span class="line">  - master</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">- npm install</span><br><span class="line"></span><br><span class="line">before_script:</span><br><span class="line">- git config --global user.name &apos;Khaja Minhajuddin&apos;</span><br><span class="line">- git config --global user.email &apos;minhajuddin.k@gmail.com&apos;</span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">- ./node_modules/.bin/hexo generate</span><br><span class="line"></span><br><span class="line">after_success:</span><br><span class="line">- mkdir .deploy</span><br><span class="line">- cd .deploy</span><br><span class="line">- git clone --depth 1 --branch gh-pages --single-branch $DEPLOY_REPO . || (git init &amp;&amp; git remote add -t gh-pages origin $DEPLOY_REPO)</span><br><span class="line">- rm -rf ./*                      # Clear old verion</span><br><span class="line">- cp -r ../public/* .             # Copy over files for new version</span><br><span class="line">- git add -A .</span><br><span class="line">- git commit -m &apos;Site updated&apos;    # Make a new commit for new version</span><br><span class="line">- git branch -m gh-pages</span><br><span class="line">- git push -q -u origin gh-pages  # Push silently so we don&apos;t leak information</span><br></pre></td></tr></table></figure>

        
      


      

    </div>
    <footer class="article-footer">
      <a data-url="http://minhajuddin.com/2018/05/09/how-to-setup-your-hexo-blog-to-be-automatically-published-using-travis-ci/" data-id="ck9vl2ttq0056zfwop4t1tlyh" class="article-share-link">Share</a>
      
        <a href="http://minhajuddin.com/2018/05/09/how-to-setup-your-hexo-blog-to-be-automatically-published-using-travis-ci/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github-pages/">GitHub Pages</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/travis/">travis</a></li></ul>

    </footer>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  

        </section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap highlighted-widget">
  <div class="widget">
    Thanks for visiting my blog. If you find this content interesting, Please take a look at
    <a href="https://liveformhq.com/?utm_source=minhajuddin.com">LiveForm, it provides you with a simple way to host Online Forms for your websites. Be it Contact Forms/Feedback Forms or any custom forms.</a>.
    <div style="text-align: center; margin-top: 10px;">
      <a href="https://liveformhq.com/registrations/new?plan=starter" style="text-decoration: none; text-align: center;display: inline-block; padding: 10px 50px; background-color: #ff3e01; color: white;">
      Sign up now!
      </a>
    </div>
  </div>
</div>

<div class="widget-wrap">
  <h3 class="widget-title">Resources</h3>
  <div class="widget">
    <ul>
      <li><a href="/about/">About Me</a></li>
      <li><a href="/projects/">My Projects</a></li>
      <li><a href="https://github.com/minhajuddin">Github</a></li>
      <li><a href="https://twitter.com/minhajuddin">@minhajuddin</a></li>
      <li><a href="/atom.xml">Subscribe</a></li>
    </ul>
  </div>
</div>

<div class="widget-wrap">
  <h3 class="widget-title">Side Projects</h3>
  <div class="widget">
    <ul>
      <li><a href="http://readcode.in/">Readcode - Makes reading source code a pleasure</a></li>
      <li><a href="https://getsimpleform.com/">Simple Form - Build simple online forms</a></li>
      <li><a href="https://liveformhq.com/">LiveForm - Online forms for professional designers and developers</a></li>
      <li><a href="http://getsimplesite.com/">SimpleSite - A powerful javascript based CMS</a></li>
      <li><a href="http://www.websrvr.in/">Websrvr - Host your websites using Dropbox</a></li>
      <li><a href="http://www.schoolone.in/">SchoolOne - A solution for your school management</a></li>
      <li><a href="https://simplemessage.in/">SimpleMessage - Send SMS messages with a powerful UI</a></li>
      <li><a href="https://slugex.com/">Slugex - Host your apps using CLI</a></li>
    </ul>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/05/06/how-to-create-temporary-bastion-ec2-instances-using-terraform/">How to create temporary bastion EC2 instances using Terraform</a>
          </li>
        
          <li>
            <a href="/2020/05/03/many-to-many-relationships-in-ecto-and-phoenix-for-products-and-tags/">many_to_many relationships in Ecto and Phoenix for Products and Tags</a>
          </li>
        
          <li>
            <a href="/2019/11/30/how-to-dump-a-partial-sample-table-1000-rows-in-postgres-using-pg-dump/">How to dump a partial/sample table(1000 rows) in postgres using pg_dump</a>
          </li>
        
          <li>
            <a href="/2019/06/03/how-to-copy-output-of-a-function-to-your-clipboard-in-elixir-or-ruby/">How to copy output of a function to your clipboard in Elixir or Ruby</a>
          </li>
        
          <li>
            <a href="/2019/04/14/how-to-store-username-or-email-with-case-insensitive-search-using-ecto-part2/">How to store username or email with case insensitive search using Ecto - Part 2</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/aws/" style="font-size: 10px;">AWS</a> <a href="/tags/advent-of-code/" style="font-size: 10px;">Advent Of Code</a> <a href="/tags/advent-of-code/" style="font-size: 16px;">Advent of Code</a> <a href="/tags/analyze/" style="font-size: 10px;">Analyze</a> <a href="/tags/atom/" style="font-size: 10px;">Atom</a> <a href="/tags/auto-renew/" style="font-size: 10px;">Auto renew</a> <a href="/tags/automatic-generation/" style="font-size: 10px;">Automatic Generation</a> <a href="/tags/bash-completion/" style="font-size: 10px;">Bash completion</a> <a href="/tags/bastion/" style="font-size: 10px;">Bastion</a> <a href="/tags/bench/" style="font-size: 10px;">Bench</a> <a href="/tags/benchmark/" style="font-size: 10px;">Benchmark</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bits/" style="font-size: 10px;">Bits</a> <a href="/tags/blog/" style="font-size: 10px;">Blog</a> <a href="/tags/callbacks/" style="font-size: 10px;">Callbacks</a> <a href="/tags/case-insensitive/" style="font-size: 10px;">Case insensitive</a> <a href="/tags/cassette/" style="font-size: 10px;">Cassette</a> <a href="/tags/concatenate/" style="font-size: 10px;">Concatenate</a> <a href="/tags/copy/" style="font-size: 10px;">Copy</a> <a href="/tags/dry/" style="font-size: 10px;">DRY</a> <a href="/tags/debug/" style="font-size: 12px;">Debug</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/distillery/" style="font-size: 10px;">Distillery</a> <a href="/tags/documentation/" style="font-size: 10px;">Documentation</a> <a href="/tags/duplication/" style="font-size: 10px;">Duplication</a> <a href="/tags/ec2/" style="font-size: 10px;">EC2</a> <a href="/tags/erb/" style="font-size: 10px;">ERB</a> <a href="/tags/ecto/" style="font-size: 16px;">Ecto</a> <a href="/tags/elixir/" style="font-size: 20px;">Elixir</a> <a href="/tags/elm/" style="font-size: 10px;">Elm</a> <a href="/tags/email/" style="font-size: 12px;">Email</a> <a href="/tags/environment-loader/" style="font-size: 10px;">Environment Loader</a> <a href="/tags/error/" style="font-size: 10px;">Error</a> <a href="/tags/exvcr/" style="font-size: 10px;">ExVCR</a> <a href="/tags/fizzbuzz/" style="font-size: 10px;">FizzBuzz</a> <a href="/tags/genserver/" style="font-size: 10px;">GenServer</a> <a href="/tags/git/" style="font-size: 10px;">Git</a> <a href="/tags/github-pages/" style="font-size: 10px;">GitHub Pages</a> <a href="/tags/go/" style="font-size: 10px;">Go</a> <a href="/tags/google-chrome/" style="font-size: 10px;">Google Chrome</a> <a href="/tags/guard/" style="font-size: 10px;">Guard</a> <a href="/tags/hmac/" style="font-size: 10px;">HMAC</a> <a href="/tags/heroku/" style="font-size: 12px;">Heroku</a> <a href="/tags/hex/" style="font-size: 10px;">Hex</a> <a href="/tags/hotkeys/" style="font-size: 10px;">Hotkeys</a> <a href="/tags/how-to/" style="font-size: 10px;">How To</a> <a href="/tags/how-to/" style="font-size: 10px;">How to</a> <a href="/tags/iex/" style="font-size: 10px;">IEx</a> <a href="/tags/irb/" style="font-size: 10px;">IRB</a> <a href="/tags/index/" style="font-size: 12px;">Index</a> <a href="/tags/json/" style="font-size: 10px;">JSON</a> <a href="/tags/key-transform/" style="font-size: 10px;">Key Transform</a> <a href="/tags/key-value/" style="font-size: 10px;">Key-Value</a> <a href="/tags/large/" style="font-size: 10px;">Large</a> <a href="/tags/learn/" style="font-size: 10px;">Learn</a> <a href="/tags/lets-encrypt/" style="font-size: 10px;">Lets encrypt</a> <a href="/tags/lists/" style="font-size: 10px;">Lists</a> <a href="/tags/md5/" style="font-size: 10px;">MD5</a> <a href="/tags/map/" style="font-size: 12px;">Map</a> <a href="/tags/meetup/" style="font-size: 10px;">Meetup</a> <a href="/tags/migration/" style="font-size: 10px;">Migration</a> <a href="/tags/mix/" style="font-size: 10px;">Mix</a> <a href="/tags/network/" style="font-size: 10px;">Network</a> <a href="/tags/nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/nokogiri/" style="font-size: 10px;">Nokogiri</a> <a href="/tags/order/" style="font-size: 10px;">Order</a> <a href="/tags/pdf/" style="font-size: 10px;">PDF</a> <a href="/tags/pandora/" style="font-size: 10px;">Pandora</a> <a href="/tags/pattern-matching/" style="font-size: 10px;">Pattern matching</a> <a href="/tags/pearls/" style="font-size: 10px;">Pearls</a> <a href="/tags/perf/" style="font-size: 10px;">Perf</a> <a href="/tags/phoenix/" style="font-size: 16px;">Phoenix</a> <a href="/tags/pianobar/" style="font-size: 12px;">Pianobar</a> <a href="/tags/pipelines/" style="font-size: 10px;">Pipelines</a> <a href="/tags/plug/" style="font-size: 10px;">Plug</a> <a href="/tags/postgresql/" style="font-size: 14px;">Postgresql</a> <a href="/tags/presentation/" style="font-size: 10px;">Presentation</a> <a href="/tags/process/" style="font-size: 10px;">Process</a> <a href="/tags/product/" style="font-size: 10px;">Product</a> <a href="/tags/proxy/" style="font-size: 10px;">Proxy</a> <a href="/tags/proxyjump/" style="font-size: 10px;">ProxyJump</a> <a href="/tags/pry/" style="font-size: 10px;">Pry</a> <a href="/tags/rails/" style="font-size: 10px;">Rails</a> <a href="/tags/rails-migrations/" style="font-size: 10px;">Rails Migrations</a> <a href="/tags/redis/" style="font-size: 12px;">Redis</a> <a href="/tags/restricted-subdomains/" style="font-size: 10px;">Restricted Subdomains</a> <a href="/tags/retrieval/" style="font-size: 10px;">Retrieval</a> <a href="/tags/ruby/" style="font-size: 16px;">Ruby</a> <a href="/tags/ssh/" style="font-size: 10px;">SSH</a> <a href="/tags/saas-tip/" style="font-size: 10px;">SaaS Tip</a> <a href="/tags/semver/" style="font-size: 10px;">SemVer</a> <a href="/tags/sign-request/" style="font-size: 10px;">Sign Request</a> <a href="/tags/sleep/" style="font-size: 10px;">Sleep</a> <a href="/tags/startup/" style="font-size: 10px;">Startup</a> <a href="/tags/static-site-generator/" style="font-size: 10px;">Static Site Generator</a> <a href="/tags/static-sites/" style="font-size: 10px;">Static Sites</a> <a href="/tags/string/" style="font-size: 10px;">String</a> <a href="/tags/structure/" style="font-size: 10px;">Structure</a> <a href="/tags/til/" style="font-size: 10px;">TIL</a> <a href="/tags/tags/" style="font-size: 10px;">Tags</a> <a href="/tags/task/" style="font-size: 10px;">Task</a> <a href="/tags/terraform/" style="font-size: 10px;">Terraform</a> <a href="/tags/ticker/" style="font-size: 10px;">Ticker</a> <a href="/tags/timeout/" style="font-size: 10px;">Timeout</a> <a href="/tags/tip/" style="font-size: 10px;">Tip</a> <a href="/tags/tmux/" style="font-size: 12px;">Tmux</a> <a href="/tags/username/" style="font-size: 12px;">Username</a> <a href="/tags/version/" style="font-size: 10px;">Version</a> <a href="/tags/vim/" style="font-size: 12px;">Vim</a> <a href="/tags/xml/" style="font-size: 10px;">Xml</a> <a href="/tags/xml-pluck/" style="font-size: 10px;">Xml Pluck</a> <a href="/tags/ajax/" style="font-size: 10px;">ajax,</a> <a href="/tags/algorithm/" style="font-size: 12px;">algorithm</a> <a href="/tags/angularjs/" style="font-size: 10px;">angularjs</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/authenticate/" style="font-size: 10px;">authenticate</a> <a href="/tags/automate/" style="font-size: 10px;">automate</a> <a href="/tags/automatic/" style="font-size: 10px;">automatic</a> <a href="/tags/banshee/" style="font-size: 10px;">banshee,</a> <a href="/tags/barefooters/" style="font-size: 10px;">barefooters</a> <a href="/tags/bash/" style="font-size: 16px;">bash</a> <a href="/tags/bookmarklet/" style="font-size: 12px;">bookmarklet</a> <a href="/tags/books/" style="font-size: 10px;">books</a> <a href="/tags/brute-force/" style="font-size: 10px;">brute-force</a> <a href="/tags/ci/" style="font-size: 10px;">ci</a> <a href="/tags/cleanup/" style="font-size: 10px;">cleanup</a> <a href="/tags/clever-code/" style="font-size: 10px;">clever-code</a> <a href="/tags/cloud-computing/" style="font-size: 10px;">cloud-computing</a> <a href="/tags/command-t/" style="font-size: 10px;">command-t</a> <a href="/tags/communication/" style="font-size: 10px;">communication</a> <a href="/tags/console/" style="font-size: 10px;">console</a> <a href="/tags/copy/" style="font-size: 10px;">copy</a> <a href="/tags/coreos/" style="font-size: 10px;">coreos</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/design/" style="font-size: 10px;">design</a> <a href="/tags/devise/" style="font-size: 10px;">devise</a> <a href="/tags/diff/" style="font-size: 10px;">diff</a> <a href="/tags/difficulty/" style="font-size: 10px;">difficulty</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/downtime-calculation/" style="font-size: 10px;">downtime calculation</a> <a href="/tags/drag-and-drop/" style="font-size: 10px;">drag-and-drop</a> <a href="/tags/eager-load/" style="font-size: 10px;">eager-load</a> <a href="/tags/ecommerce/" style="font-size: 10px;">ecommerce</a> <a href="/tags/elastic-object/" style="font-size: 10px;">elastic object</a> <a href="/tags/ets/" style="font-size: 12px;">ets</a> <a href="/tags/experiment/" style="font-size: 10px;">experiment</a> <a href="/tags/explore/" style="font-size: 10px;">explore</a> <a href="/tags/fear/" style="font-size: 10px;">fear</a> <a href="/tags/flash/" style="font-size: 10px;">flash,</a> <a href="/tags/for-sohel/" style="font-size: 12px;">for-sohel</a> <a href="/tags/form/" style="font-size: 10px;">form</a> <a href="/tags/free-lunch/" style="font-size: 10px;">free-lunch</a> <a href="/tags/getsimpleform/" style="font-size: 10px;">getsimpleform</a> <a href="/tags/git/" style="font-size: 18px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/go/" style="font-size: 16px;">go</a> <a href="/tags/godoc/" style="font-size: 10px;">godoc</a> <a href="/tags/gtimelog/" style="font-size: 10px;">gtimelog</a> <a href="/tags/hack/" style="font-size: 14px;">hack</a> <a href="/tags/hash/" style="font-size: 10px;">hash</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/iex/" style="font-size: 10px;">iex</a> <a href="/tags/import/" style="font-size: 10px;">import</a> <a href="/tags/india/" style="font-size: 10px;">india</a> <a href="/tags/inotify/" style="font-size: 10px;">inotify</a> <a href="/tags/javascript/" style="font-size: 14px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/learn/" style="font-size: 14px;">learn</a> <a href="/tags/learn-go/" style="font-size: 10px;">learn-go</a> <a href="/tags/lego/" style="font-size: 10px;">lego</a> <a href="/tags/limit/" style="font-size: 10px;">limit</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/magic-strings/" style="font-size: 10px;">magic strings</a> <a href="/tags/many-to-many/" style="font-size: 10px;">many_to_many</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/metaprogramming/" style="font-size: 10px;">metaprogramming</a> <a href="/tags/mundane-code/" style="font-size: 10px;">mundane-code</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/mutt/" style="font-size: 10px;">mutt</a> <a href="/tags/open-struct/" style="font-size: 10px;">open struct</a> <a href="/tags/partial-table/" style="font-size: 10px;">partial table</a> <a href="/tags/pbcopy/" style="font-size: 10px;">pbcopy</a> <a href="/tags/perception/" style="font-size: 10px;">perception,</a> <a href="/tags/pg-dump/" style="font-size: 10px;">pg_dump</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql,</a> <a href="/tags/production/" style="font-size: 10px;">production</a> <a href="/tags/prompt/" style="font-size: 10px;">prompt</a> <a href="/tags/ps1/" style="font-size: 10px;">ps1</a> <a href="/tags/psql/" style="font-size: 10px;">psql</a> <a href="/tags/rails/" style="font-size: 18px;">rails</a> <a href="/tags/raw/" style="font-size: 10px;">raw</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/relationships/" style="font-size: 10px;">relationships</a> <a href="/tags/reverse/" style="font-size: 10px;">reverse</a> <a href="/tags/review/" style="font-size: 10px;">review</a> <a href="/tags/rspec/" style="font-size: 12px;">rspec</a> <a href="/tags/ruby/" style="font-size: 16px;">ruby</a> <a href="/tags/rvm/" style="font-size: 10px;">rvm</a> <a href="/tags/sample/" style="font-size: 10px;">sample</a> <a href="/tags/script/" style="font-size: 10px;">script</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/shiny/" style="font-size: 10px;">shiny,</a> <a href="/tags/simpleform/" style="font-size: 10px;">simpleform</a> <a href="/tags/sleep/" style="font-size: 10px;">sleep</a> <a href="/tags/socks5/" style="font-size: 10px;">socks5</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/solving/" style="font-size: 10px;">solving</a> <a href="/tags/submodules/" style="font-size: 10px;">submodules</a> <a href="/tags/substance/" style="font-size: 10px;">substance</a> <a href="/tags/sugar-coat/" style="font-size: 10px;">sugar-coat</a> <a href="/tags/template/" style="font-size: 10px;">template</a> <a href="/tags/templates/" style="font-size: 10px;">templates</a> <a href="/tags/temptation/" style="font-size: 10px;">temptation</a> <a href="/tags/terminal/" style="font-size: 10px;">terminal</a> <a href="/tags/thinking/" style="font-size: 10px;">thinking</a> <a href="/tags/time/" style="font-size: 12px;">time</a> <a href="/tags/time-overlap/" style="font-size: 10px;">time-overlap</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/todo-list/" style="font-size: 10px;">todo-list</a> <a href="/tags/travis/" style="font-size: 10px;">travis</a> <a href="/tags/update/" style="font-size: 10px;">update</a> <a href="/tags/upstart/" style="font-size: 10px;">upstart</a> <a href="/tags/usability/" style="font-size: 10px;">usability,</a> <a href="/tags/util/" style="font-size: 10px;">util</a> <a href="/tags/utility/" style="font-size: 12px;">utility</a> <a href="/tags/ux/" style="font-size: 10px;">ux</a> <a href="/tags/viewer/" style="font-size: 10px;">viewer</a> <a href="/tags/vim/" style="font-size: 16px;">vim</a> <a href="/tags/virtualization/" style="font-size: 10px;">virtualization</a> <a href="/tags/watch/" style="font-size: 10px;">watch</a> <a href="/tags/workflow/" style="font-size: 10px;">workflow</a> <a href="/tags/xclip/" style="font-size: 12px;">xclip</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">January 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03/">March 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">January 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">August 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">July 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">April 2009</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/">AWS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/advent-of-code/">Advent Of Code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/advent-of-code/">Advent of Code</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/analyze/">Analyze</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atom/">Atom</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auto-renew/">Auto renew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automatic-generation/">Automatic Generation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash-completion/">Bash completion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bastion/">Bastion</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bench/">Bench</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/benchmark/">Benchmark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/binary/">Binary</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bits/">Bits</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">Blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/callbacks/">Callbacks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/case-insensitive/">Case insensitive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cassette/">Cassette</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concatenate/">Concatenate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/copy/">Copy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dry/">DRY</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">Debug</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deploy/">Deploy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/distillery/">Distillery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/documentation/">Documentation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/duplication/">Duplication</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ec2/">EC2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/erb/">ERB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ecto/">Ecto</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elixir/">Elixir</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elm/">Elm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/email/">Email</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/environment-loader/">Environment Loader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/">Error</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exvcr/">ExVCR</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fizzbuzz/">FizzBuzz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/genserver/">GenServer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/">GitHub Pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">Go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-chrome/">Google Chrome</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/guard/">Guard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hmac/">HMAC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heroku/">Heroku</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hex/">Hex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hotkeys/">Hotkeys</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/how-to/">How To</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/how-to/">How to</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iex/">IEx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/irb/">IRB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/index/">Index</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/">JSON</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/key-transform/">Key Transform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/key-value/">Key-Value</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/large/">Large</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/">Learn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lets-encrypt/">Lets encrypt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lists/">Lists</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/md5/">MD5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/map/">Map</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/meetup/">Meetup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/migration/">Migration</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mix/">Mix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">Network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nokogiri/">Nokogiri</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/order/">Order</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pdf/">PDF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandora/">Pandora</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pattern-matching/">Pattern matching</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pearls/">Pearls</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perf/">Perf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/phoenix/">Phoenix</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pianobar/">Pianobar</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipelines/">Pipelines</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plug/">Plug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">Postgresql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/presentation/">Presentation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/">Process</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/product/">Product</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/">Proxy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxyjump/">ProxyJump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pry/">Pry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">Rails</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails-migrations/">Rails Migrations</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/restricted-subdomains/">Restricted Subdomains</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/retrieval/">Retrieval</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">Ruby</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">SSH</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saas-tip/">SaaS Tip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/semver/">SemVer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sign-request/">Sign Request</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sleep/">Sleep</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/startup/">Startup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/static-site-generator/">Static Site Generator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/static-sites/">Static Sites</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/string/">String</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structure/">Structure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/til/">TIL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tags/">Tags</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/task/">Task</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/terraform/">Terraform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ticker/">Ticker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/timeout/">Timeout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tip/">Tip</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">Tmux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/username/">Username</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/version/">Version</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">Vim</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/">Xml</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml-pluck/">Xml Pluck</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ajax/">ajax,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angularjs/">angularjs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/authenticate/">authenticate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automate/">automate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automatic/">automatic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/banshee/">banshee,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/barefooters/">barefooters</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bookmarklet/">bookmarklet</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/books/">books</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/brute-force/">brute-force</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ci/">ci</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cleanup/">cleanup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clever-code/">clever-code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud-computing/">cloud-computing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/command-t/">command-t</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/communication/">communication</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/console/">console</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/copy/">copy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coreos/">coreos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debug/">debug</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design/">design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devise/">devise</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diff/">diff</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/difficulty/">difficulty</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/downtime-calculation/">downtime calculation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/drag-and-drop/">drag-and-drop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eager-load/">eager-load</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ecommerce/">ecommerce</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic-object/">elastic object</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ets/">ets</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experiment/">experiment</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/explore/">explore</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fear/">fear</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flash/">flash,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/for-sohel/">for-sohel</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/form/">form</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/free-lunch/">free-lunch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/getsimpleform/">getsimpleform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/godoc/">godoc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gtimelog/">gtimelog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hack/">hack</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hash/">hash</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iex/">iex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/import/">import</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/india/">india</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/">jquery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn/">learn</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/learn-go/">learn-go</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lego/">lego</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/limit/">limit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/magic-strings/">magic strings</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/many-to-many/">many_to_many</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metaprogramming/">metaprogramming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mundane-code/">mundane-code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mutt/">mutt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/open-struct/">open struct</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/partial-table/">partial table</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pbcopy/">pbcopy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/perception/">perception,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pg-dump/">pg_dump</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">postgresql,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/production/">production</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompt/">prompt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ps1/">ps1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psql/">psql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rails/">rails</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raw/">raw</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/relationships/">relationships</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reverse/">reverse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/review/">review</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rspec/">rspec</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ruby/">ruby</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rvm/">rvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sample/">sample</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/script/">script</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shiny/">shiny,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/simpleform/">simpleform</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sleep/">sleep</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socks5/">socks5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/">software</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/solving/">solving</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/submodules/">submodules</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/substance/">substance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sugar-coat/">sugar-coat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/template/">template</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/templates/">templates</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/temptation/">temptation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/terminal/">terminal</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thinking/">thinking</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time/">time</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/time-overlap/">time-overlap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tmux/">tmux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/todo-list/">todo-list</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travis/">travis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/update/">update</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upstart/">upstart</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/usability/">usability,</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/util/">util</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utility/">utility</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ux/">ux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewer/">viewer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virtualization/">virtualization</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/watch/">watch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/workflow/">workflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xclip/">xclip</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
</aside>

        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Khaja Minhajuddin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
    <a href="/about/#Contact_Me" class="mobile-nav-link">Contact</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'minhajuddin';
  
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>
